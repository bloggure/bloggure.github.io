<!DOCTYPE html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en">
  <!--<![endif]-->
  <head>
    <meta charset="utf-8" />
    <title>GitlabHQ - SQLite to mySQL &#8211; Bloggure</title>
    <meta
      name="description"
      content="Multi author blog about programming, computing and geek stuff"
    />
    <meta name="keywords" content="" />

    <!-- Open Graph -->
    <meta property="og:locale" content="en_US" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="GitlabHQ - SQLite to mySQL" />
    <meta
      property="og:description"
      content="Multi author blog about programming, computing and geek stuff"
    />
    <meta
      property="og:url"
      content="http://www.bloggure.info/work/gitlabhq-sqlite-to-mysql.html"
    />
    <meta property="og:site_name" content="Bloggure" />

    <link
      rel="canonical"
      href="http://www.bloggure.info/work/gitlabhq-sqlite-to-mysql.html"
    />
    <link
      href="http://www.bloggure.info/feed.xml"
      type="application/atom+xml"
      rel="alternate"
      title="Bloggure Feed"
    />

    <!-- http://t.co/dKP3o1e -->
    <meta name="HandheldFriendly" content="True" />
    <meta name="MobileOptimized" content="320" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- For all browsers -->
    <link
      rel="stylesheet"
      href="http://www.bloggure.info/assets/css/main.css"
    />
    <!-- Webfonts -->
    <link
      href="https://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic"
      rel="stylesheet"
      type="text/css"
    />

    <meta http-equiv="cleartype" content="on" />

    <!-- Load Modernizr -->
    <script src="http://www.bloggure.info/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

    <!-- Icons -->
    <!-- 16x16 -->
    <link rel="shortcut icon" href="http://www.bloggure.info/favicon.ico" />
    <!-- 32x32 -->
    <link rel="shortcut icon" href="http://www.bloggure.info/favicon.png" />
    <!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
    <link
      rel="apple-touch-icon-precomposed"
      href="http://www.bloggure.info/images/apple-touch-icon-precomposed.png"
    />
    <!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
    <link
      rel="apple-touch-icon-precomposed"
      sizes="72x72"
      href="http://www.bloggure.info/images/apple-touch-icon-72x72-precomposed.png"
    />
    <!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
    <link
      rel="apple-touch-icon-precomposed"
      sizes="114x114"
      href="http://www.bloggure.info/images/apple-touch-icon-114x114-precomposed.png"
    />
    <!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
    <link
      rel="apple-touch-icon-precomposed"
      sizes="144x144"
      href="http://www.bloggure.info/images/apple-touch-icon-144x144-precomposed.png"
    />
  </head>

  <body id="post">
    <!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->

    <div class="entry-header">
      <header class="header-title">
        <div class="header-title-wrap">
          <h1 class="entry-title" itemprop="name">
            <a href="http://www.bloggure.info/">Bloggure</a>
          </h1>
        </div>
        <!-- /.header-title-wrap -->
      </header>
    </div>

    <div id="main" role="main">
      <article class="hentry">
        <div class="entry-content">
          <header>
            <div class="entry-meta">
              <span class="entry-date date published updated"
                ><time
                  datetime="2012-05-08T00:00:00+02:00"
                  itemprop="datePublished"
                  ><a
                    href="http://www.bloggure.info/work/gitlabhq-sqlite-to-mysql.html"
                    >May 08, 2012</a
                  ></time
                ></span
              ><span
                class="author vcard"
                itemprop="author"
                itemscope
                itemtype="http://schema.org/Person"
                ><span itemprop="name" class="fn"
                  ><a
                    href="http://www.bloggure.info/cgatay"
                    title="About cgatay"
                    itemprop="url"
                    >cgatay</a
                  ></span
                ></span
              >
            </div>
            <!-- /.entry-meta -->

            <h1 class="entry-title" itemprop="name">
              <a
                href="http://www.bloggure.info/work/gitlabhq-sqlite-to-mysql.html"
                rel="bookmark"
                title="GitlabHQ - SQLite to mySQL"
                itemprop="url"
                >GitlabHQ - SQLite to mySQL</a
              >
            </h1>
          </header>
          <!--:en--><img
            src="/images/uploads/2012/02/gitlabhq-logo.png"
            alt=""
            title="gitlabhq-logo"
            width="175"
            height="60"
            class="alignright size-full wp-image-528"
          />
          <p>
            As our <a href="http://gitlabhq.com/">GitlabHQ</a> setup at
            <a href="http://www.srmvision.com">SRMvision</a> is mean to stay, we
            wanted to migrate from the standard SQLite database to an easier to
            manage for us : mySQL.<br />
            The steps are quite straighforward, first, setup mySQL :
          </p>

          <figure class="highlight">
            <pre><code class="language-sql" data-lang="sql"><span></span><span class="k">create</span><span class="w"> </span><span class="k">database</span><span class="w"> </span><span class="n">gitlab</span><span class="p">;</span><span class="w"> </span>
<span class="k">grant</span><span class="w"> </span><span class="k">all</span><span class="w"> </span><span class="k">privileges</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">gitlab</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="ss">&quot;gitlab&quot;</span><span class="w"> </span><span class="n">identified</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="ss">&quot;gitlab&quot;</span><span class="p">;</span><span class="w"> </span>
<span class="n">flush</span><span class="w"> </span><span class="k">privileges</span><span class="p">;</span></code></pre>
          </figure>
          Then prepare to dump the data out of GitlabHQ, stop your webserver,
          then, from your GitlabHQ folder :

          <figure class="highlight">
            <pre><code class="language-bash" data-lang="bash"><span></span>bundle<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>rake<span class="w"> </span>db:data:dump<span class="w"> </span><span class="nv">RAILS_ENV</span><span class="o">=</span>production</code></pre>
          </figure>
          this will create a db/data.yml file. All you have to do now is
          reconfigure GitlabHQ to connect to mySQL and reimport the data. The
          database configuration takes place in the config/database.yml file,
          backup your existing file and rename the database.yml.example :

          <figure class="highlight">
            <pre><code class="language-bash" data-lang="bash"><span></span>mv<span class="w"> </span>config/database.yml<span class="w"> </span>config/database.yml.old
cp<span class="w"> </span>config/database.yml.example<span class="w"> </span>config/database.yml</code></pre>
          </figure>
          Then edit the file to reflect your new configuration, only the
          production section is relevant in our case :

          <figure class="highlight">
            <pre><code class="language-yaml" data-lang="yaml"><span></span><span class="nt">development</span><span class="p">:</span>
<span class="w">  </span><span class="nt">adapter</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql2</span>
<span class="w">  </span><span class="nt">encoding</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">utf8</span>
<span class="w">  </span><span class="nt">reconnect</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">  </span><span class="nt">database</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gitlabhq_development</span>
<span class="w">  </span><span class="nt">pool</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="w">  </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
<span class="w">  </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;secure</span><span class="nv"> </span><span class="s">password&quot;</span>
<span class="w">  </span><span class="c1"># socket: /tmp/mysql.sock</span>

<span class="c1"># Warning: The database defined as &quot;test&quot; will be erased and</span>
<span class="c1"># re-generated from your development database when you run &quot;rake&quot;.</span>
<span class="c1"># Do not set this db to the same as development or production.</span>
<span class="nt">test</span><span class="p">:</span>
<span class="w">  </span><span class="nt">adapter</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql2</span>
<span class="w">  </span><span class="nt">encoding</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">utf8</span>
<span class="w">  </span><span class="nt">reconnect</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">  </span><span class="nt">database</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gitlabhq_test</span>
<span class="w">  </span><span class="nt">pool</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="w">  </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
<span class="w">  </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;secure</span><span class="nv"> </span><span class="s">password&quot;</span>
<span class="w">  </span><span class="c1"># socket: /tmp/mysql.sock</span>

<span class="nt">production</span><span class="p">:</span>
<span class="w">  </span><span class="nt">adapter</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql2</span>
<span class="w">  </span><span class="nt">encoding</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">utf8</span>
<span class="w">  </span><span class="nt">reconnect</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"> </span><span class="c1"># allows to autoreconnect if the mysql service restarts</span>
<span class="w">  </span><span class="nt">database</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gitlab</span><span class="w"> </span><span class="c1"># to replace with your database name</span>
<span class="w">  </span><span class="nt">pool</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="w">  </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gitlab</span><span class="w"> </span><span class="c1"># to replace with your credentials</span>
<span class="w">  </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;gitlab&quot;</span><span class="w"> </span><span class="c1"># to replace with your credentials</span>
<span class="w">  </span><span class="nt">socket</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/run/mysqld/mysqld.sock</span><span class="w"> </span><span class="c1"># mysql socket location on debian</span></code></pre>
          </figure>
          Once this is done, you have to create the schema and restore your data
          :

          <figure class="highlight">
            <pre><code class="language-bash" data-lang="bash"><span></span>bundle<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>rake<span class="w"> </span>db:setup<span class="w"> </span><span class="nv">RAILS_ENV</span><span class="o">=</span>production
bundle<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>rake<span class="w"> </span>db:data:load<span class="w"> </span><span class="nv">RAILS_ENV</span><span class="o">=</span>production</code></pre>
          </figure>

          Job's done, you just need to restart the GitlabHQ server now (nginx,
          apache...). If you encounter a problem and this does not work as
          expected, you just have to restore the database.yml.old file to go
          back to SQLite.<!--:--><!--:fr<img src="/images/uploads/2012/02/gitlabhq-logo.png" alt="" title="gitlabhq-logo" width="175" height="60" class="alignright size-full wp-image-528" /><p>Comme notre installation de <a href="http://gitlabhq.com/">GitlabHQ</a> à <a href="http://www.srmvision.com">SRMvision</a> est faite pour rester, nous avons décidé de migrer de la base SQLite vers un système plus simple à gérer pour nous : mySQL.<br /> Les étapes sont assez simple, premièrement, configurons mySQL :</p>
<pre class="brush: sql">
create database gitlab; 
grant all privileges on gitlab.* to "gitlab" identified by "gitlab"; 
flush privileges;</pre>
Ensuite récupérons les données existantes dans GitlabHQ, arrêtez votre serveur, puis, depuis le dossier de GitlabHQ : 
<pre class="brush: bash">bundle exec rake db:data:dump RAILS_ENV=production</pre>
ceci va créer un fichier db/data.yml. Tout ce qu'il vous reste à faire maintenant est de reconfigurer GitlabHQ pour lui dire de se connecter à mySQL et d'y intégrer les données existantes.
La configuration de la base de données à utiliser se trouve dans le fichier config/database.yml, sauvegardez le et récupérez le database.yml.example comme base de travail:
<pre class="brush: bash">
mv config/database.yml config/database.yml.old
cp config/database.yml.example config/database.yml
</pre>
Il ne vous reste qu'à éditer le fichier pour refléter votre configuration, seule la partie production du fichier est utile dans notre cas :
<pre class="brush: bash" ighlight="27,28,30,31,32" title="database.yml">
development:
  adapter: mysql2
  encoding: utf8
  reconnect: false
  database: gitlabhq_development
  pool: 5
  username: root
  password: "secure password"
  # socket: /tmp/mysql.sock

# Warning: The database defined as "test" will be erased and
# re-generated from your development database when you run "rake".
# Do not set this db to the same as development or production.
test:
  adapter: mysql2
  encoding: utf8
  reconnect: false
  database: gitlabhq_test
  pool: 5
  username: root
  password: "secure password"
  # socket: /tmp/mysql.sock

production:
  adapter: mysql2
  encoding: utf8
  reconnect: true # permet de se reconnecter quand le service mysql redémarre
  database: gitlab # à remplacer avec le nom de votre base
  pool: 5
  username: gitlab # à remplacer avec vos identifiants
  password: "gitlab" # à remplacer avec vos identifiants
  socket: /var/run/mysqld/mysqld.sock # mysql socket location on debian
</pre>
Une fois ceci fait, il vous reste à créer le schéma et à importer vos données sauvegardées :
<pre class="brush: bash">
bundle exec rake db:setup RAILS_ENV=production
bundle exec rake db:data:load RAILS_ENV=production
</pre>
C'est tout, il ne reste plus qu'à redémarrer le serveur de GitlabHQ. Si toutefois ça ne fonctionnait pas, vous n'avez qu'à restaurer le fichier database.yml.old pour retourner à la configuration par défaut utilisant SQLite.<-->

          <footer class="entry-meta">
            <span class="entry-tags"></span>

            <div class="social-share">
              <ul class="socialcount socialcount-small inline-list">
                <li class="facebook">
                  <a
                    href="https://www.facebook.com/sharer/sharer.php?u=http://www.bloggure.info/work/gitlabhq-sqlite-to-mysql.html"
                    title="Share on Facebook"
                    ><span class="count"
                      ><i class="fa fa-facebook-square"></i> Like</span
                    ></a
                  >
                </li>
                <li class="twitter">
                  <a
                    href="https://twitter.com/intent/tweet?text=http://www.bloggure.info/work/gitlabhq-sqlite-to-mysql.html"
                    title="Share on Twitter"
                    ><span class="count"
                      ><i class="fa fa-twitter-square"></i> Tweet</span
                    ></a
                  >
                </li>
              </ul>
            </div>
            <!-- /.social-share -->
          </footer>
        </div>
        <!-- /.entry-content -->

        <div class="read-more">
          <div class="read-more-header">
            <a
              href="http://www.bloggure.info/.git/ci/control-trac-ticket-workflow-from-your-git-commits"
              class="read-more-btn"
              >Read More</a
            >
          </div>
          <!-- /.read-more-header -->
          <div class="read-more-content">
            <h3>
              <a
                href="http://www.bloggure.info/Swift_VisibleForTesting_Macro"
                title="Swift macro : @VisibleForTesting"
                >Swift macro : @VisibleForTesting</a
              >
            </h3>
            <p>
              As an ancient Java developer, I’ve learned to use a set of
              annotations to bring meta programming in my projects. Meta
              programming can be ...&hellip;
              <a href="http://www.bloggure.info/Swift_VisibleForTesting_Macro"
                >Continue reading</a
              >
            </p>
          </div>
          <!-- /.read-more-content -->

          <div class="read-more-list">
            <div class="list-item">
              <h4>
                <a
                  href="http://www.bloggure.info/iOS-DarkModeBackground-App-Switcher"
                  title="Dark Mode iOS Snapshot"
                  >Dark Mode iOS Snapshot</a
                >
              </h4>
              <span>Published on January 10, 2021</span>
            </div>
            <!-- /.list-item -->

            <div class="list-item">
              <h4>
                <a href="http://www.bloggure.info/git-gone" title="Git-gone"
                  >Git-gone</a
                >
              </h4>
              <span>Published on December 31, 2020</span>
            </div>
            <!-- /.list-item -->
          </div>
          <!-- /.read-more-list -->
        </div>
        <!-- /.read-more -->
      </article>
    </div>
    <!-- /#main -->

    <div class="footer-wrapper">
      <footer role="contentinfo">
        <span
          >&copy; 2025 . Powered by
          <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using a theme
          based on
          <a
            href="https://mademistakes.com/work/hpstr-jekyll-theme/"
            rel="nofollow"
            >HPSTR</a
          >.</span
        >
      </footer>
    </div>
    <!-- /.footer-wrapper -->

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script>
      window.jQuery ||
        document.write(
          '<script src="http://www.bloggure.info/assets/js/vendor/jquery-1.9.1.min.js"><\/script>'
        );
    </script>
    <script src="http://www.bloggure.info/assets/js/scripts.min.js"></script>

    <!-- Asynchronous Google Analytics snippet -->
    <script>
      (function (i, s, o, g, r, a, m) {
        i["GoogleAnalyticsObject"] = r;
        (i[r] =
          i[r] ||
          function () {
            (i[r].q = i[r].q || []).push(arguments);
          }),
          (i[r].l = 1 * new Date());
        (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m);
      })(
        window,
        document,
        "script",
        "//www.google-analytics.com/analytics.js",
        "ga"
      );

      ga("create", "UA-11718843-3", "auto");
      ga("require", "linkid", "linkid.js");
      ga("send", "pageview");
    </script>
  </body>
</html>
