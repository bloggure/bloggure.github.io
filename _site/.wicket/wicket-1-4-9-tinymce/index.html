<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Wicket 1.4.x - TinyMCE &#8211; Site Title</title>
<meta name="description" content="Describe your website here.">
<meta name="keywords" content="java, javascript, tinymce, wicket">



<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Wicket 1.4.x - TinyMCE">
<meta property="og:description" content="Describe your website here.">
<meta property="og:url" content="/.wicket/wicket-1-4-9-tinymce">
<meta property="og:site_name" content="Site Title">





<link rel="canonical" href="/.wicket/wicket-1-4-9-tinymce">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Site Title Feed">


<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.min.css">
<!-- Webfonts -->
<link href="http://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">

</head>

<body id="post"  itemscope itemtype="http://schema.org/WebPage">

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<nav id="dl-menu" class="dl-menuwrapper" role="navigation" itemscope itemtype="http://schema.org/SiteNavigationElement">
	<button class="dl-trigger">Open Menu</button>
	<ul class="dl-menu">
		<li><a href="">Home</a></li>
		<li>
			<a href="#">About</a>
			<ul class="dl-submenu">
				<li>
					<img src="/images/avatar.jpg" alt="Your Name photo" class="author-photo">
					<h4>Your Name</h4>
					<p>Your bio goes here. It shouldn't be super long but a good two sentences or two should suffice.</p>
				</li>
				<li><a href="/about/">Learn More</a></li>
				<li>
					<a href="mailto:you@email.com"><i class="icon-envelope"></i> Email</a>
				</li>
				
				
				
				
				
				
				
				
				
			</ul><!-- /.dl-submenu -->
		</li>
		<li>
			<a href="#">Posts</a>
			<ul class="dl-submenu">
				<li><a href="/archive/">All Posts</a></li>
				<li><a href="/tags/">All Tags</a></li>
			</ul>
		</li>
		<li><a href="/theme-setup">Theme Setup</a></li><li><a href="http://mademistakes.com">External Link</a></li>
	</ul><!-- /.dl-menu -->
</nav><!-- /.dl-menuwrapper -->




<div id="main" role="main" itemprop="mainContentOfPage" itemscope itemtype="http://schema.org/Blog">
  <article class="hentry" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
    <header class="header-title">
      <div class="header-title-wrap">
        
          <h1 class="entry-title" itemprop="name"><a href="/.wicket/wicket-1-4-9-tinymce" rel="bookmark" title="Wicket 1.4.x - TinyMCE" itemprop="url">Wicket 1.4.x - TinyMCE</a></h1>
        
        <h2>October 24, 2010</h2>
      </div><!-- /.header-title-wrap -->
    </header>
    <div class="entry-content" itemprop="description">
      <!--:en--><img class="alignleft size-full wp-image-90" title="Wicket" src="http://www.bloggure.info/wp-content/uploads/2010/10/logo-wicket1.png" alt="" width="120" height="119" />Heya all,

I am trying to revive this blog from a long period of sleep. Let's start today with a little Java trick I made to have a working TinyMCE implementation using Wicket (tested over 1.4.9 and 1.4.13 in my case but I think it should work for any 1.4.x at least, please report successful attempts under other releases).

For newcomers, <a href="http://tinymce.moxiecode.com/" target="_blank">TinyMCE</a> is a really powerful WYSIWYG editor written entirely in Javascript, it features plugin and theme ability in order to be THE editor to use in your projects. <a href="http://wicket.apache.org/" target="_blank">Apache Wicket</a> is a really powerful web framework based on Java EE specs (I think I'll talk a lot about Wicket in here...).

An implementation of TinyMCE for Wicket exists, it'll be the first result you get when you ask your old pal G***** a hand. But, this implementation is a bit tricky to find (outdated links everywhere) and not feature complete (or not fully complete), as I explain in the read more part...

<!--:--><!--:fr--><em>Cet article n'a pas été traduit, veuillez trouver ci-dessous sa version anglaise</em>

<img class="alignleft size-full wp-image-90" title="Wicket" src="http://www.bloggure.info/wp-content/uploads/2010/10/logo-wicket1.png" alt="" width="120" height="119" />Heya all,

I am trying to revive this blog from a long period of sleep. Let's start today with a little Java trick I made to have a working TinyMCE implementation using Wicket (tested over 1.4.9 and 1.4.13 in my case but I think it should work for any 1.4.x at least, please report successful attempts under other releases).

For newcomers, <a href="http://tinymce.moxiecode.com/" target="_blank">TinyMCE</a> is a really powerful WYSIWYG editor written entirely in Javascript, it features plugin and theme ability in order to be THE editor to use in your projects. <a href="http://wicket.apache.org/" target="_blank">Apache Wicket</a> is a really powerful web framework based on Java EE specs (I think I'll talk a lot about Wicket in here...).

An implementation of TinyMCE for Wicket exists, it'll be the first result you get when you ask your old pal G***** a hand. But, this implementation is a bit tricky to find (outdated links everywhere) and not feature complete (or not fully complete), as I explain in the read more part...

<!--:--><!--more--><!--:en-->

You can checkout latest almost working release from <a href="https://wicket-stuff.svn.sourceforge.net/svnroot/wicket-stuff/releases/wicketstuff-core-1.4-rc7/tinymce-parent" target="_blank">there</a> by using the following command line :

[code lang="bash" light="true"] svn co https://wicket-stuff.svn.sourceforge.net/svnroot/wicket-stuff/releases/wicketstuff-core-1.4-rc7/tinymce-parent[/code]

Let me explain what problem I encountered, it happens only on isolated cases (ajax pushing the whole WYSIWYG shebang on a page without that mess). TinyMCE is then lost, and the only output you get when you try to call init() is <code>tinyMCE is undefined</code> on your Javascript console. My first thought was to replace the outdated version bundled (3.1.0.1), so I headed to TinyMCE's website , downloaded latest version so far (3.3.9.2) and replaced it in my workspace. A try later and no luck, the problem is still here.

What's happening, why on hell this working component don't want to work anymore ? By digging into TinyMCE's code, you'll find that it looks for its baseURL, for lazy loading stuffs (depending on what you use), but Wicket responds to Ajax  headers contribution in a special way : instead of appending regular
<code>&lt;script type='text/javascript' src='myurltomyfile.js'&gt;&lt;/script&gt;</code>
it appends
<code>&lt;script type='text/javascript' src_='myurltomyfile.js'&gt;[content of myurltomyfile.js]&lt;/script&gt;</code>
to the body of the document.

This particular way of answering to browser is not well handled by TinyMCE, which looks up its baseURL by parsing script tags present in the DOM. The hack to circumvent this is really simple, make TinyMCE find its baseURL by reacting on src_ attributes. The following listing shows the patch in <code>tiny_mce_src.js</code> on the <code>getBase(n)</code>method :

[code lang="js" highlight="2,3,4,5"]function getBase(n) {
    var src_ = n.getAttribute(&quot;src_&quot;);
    if (src_) {
        n.src = src_;
    }
   if (n.src &amp;&amp; /tiny_mce(|_gzip|_jquery|_prototype|_full)(_dev|_src)?.js/.test(n.src)) {
        if (/_(src|dev)\.js/g.test(n.src)) {
            t.suffix = '_src';
        }
        if ((p = n.src.indexOf('?')) != -1) {
            t.query = n.src.substring(p + 1);
        }

        t.baseURL = n.src.substring(0, n.src.lastIndexOf('/'));

        // If path to script is relative and a base href was found add that one infront
        // the src property will always be an absolute one on non IE browsers and IE 8
        // so this logic will basically only be executed on older IE versions
        if (base &amp;&amp; t.baseURL.indexOf('://') == -1 &amp;&amp; t.baseURL.indexOf('/') !== 0) {
            t.baseURL = base + t.baseURL;
        }
        return t.baseURL;
  }
  return null;
}[/code]

With this hack, console error yelling <code>tinyMCE is undefined</code> is gone. No more error but the editor still does not work, TinyMCE waits for the document to be ready before calling its render phase. Let's fake it by flagging when we're coming from a Wicket Ajax request. We simply add an attribute to tinyMCE object : in the <code>_init()</code> method

[code lang="js"]
t.isAjax = false;
[/code]

We flag in the <code>getBase(n)</code> when we come from Wicket Ajax (when we get something like <code>&lt;script src_=""&gt;&lt;/script&gt;</code>)

[code lang="js" highlight="2"]if (src_) {
    t.isAjax = true;
    n.src = src_;
}[/code]

and we set the <code>domLoaded</code> flag to the newly introduced attribute at the end of the JavaScript file :

[code lang="js"]
tinymce.dom.Event.domLoaded = tinymce.isAjax;
[/code]

This way, TinyMCE calls its render phase directly when we call <code>init()</code> on tinyMCE object. This call is done by Wicket when the dom is ready and then we finally got TinyMCE working even when coming from an ajax javascript inclusion. The only thing you need to do in order for this to work in deployment mode is to compress tiny_mce_src.js to tiny_mce.js with this patch.

You can find the resulting  <code>tiny_mce_src.js</code> <a href="http://gist.github.com/643272">here</a>.<!--:--><!--:fr-->

You can checkout latest almost working release from <a href="https://wicket-stuff.svn.sourceforge.net/svnroot/wicket-stuff/releases/wicketstuff-core-1.4-rc7/tinymce-parent" target="_blank">there</a> by using the following command line :

[code lang="bash" light="true"] svn co https://wicket-stuff.svn.sourceforge.net/svnroot/wicket-stuff/releases/wicketstuff-core-1.4-rc7/tinymce-parent[/code]

Let me explain what problem I encountered, it happens only on isolated cases (ajax pushing the whole WYSIWYG shebang on a page without that mess). TinyMCE is then lost, and the only output you get when you try to call init() is <code>tinyMCE is undefined</code> on your Javascript console. My first thought was to replace the outdated version bundled (3.1.0.1), so I headed to TinyMCE's website , downloaded latest version so far (3.3.9.2) and replaced it in my workspace. A try later and no luck, the problem is still here.

What's happening, why on hell this working component don't want to work anymore ? By digging into TinyMCE's code, you'll find that it looks for its baseURL, for lazy loading stuffs (depending on what you use), but Wicket responds to Ajax  headers contribution in a special way : instead of appending regular
<code>&lt;script type='text/javascript' src='myurltomyfile.js'&gt;&lt;/script&gt;</code>
it appends
<code>&lt;script type='text/javascript' src_='myurltomyfile.js'&gt;[content of myurltomyfile.js]&lt;/script&gt;</code>
to the body of the document.

This particular way of answering to browser is not well handled by TinyMCE, which looks up its baseURL by parsing script tags present in the DOM. The hack to circumvent this is really simple, make TinyMCE find its baseURL by reacting on src_ attributes. The following listing shows the patch in <code>tiny_mce_src.js</code> on the <code>getBase(n)</code>method :

[code lang="js" highlight="2,3,4,5"]function getBase(n) {
    var src_ = n.getAttribute(&quot;src_&quot;);
    if (src_) {
        n.src = src_;
    }
   if (n.src &amp;&amp; /tiny_mce(|_gzip|_jquery|_prototype|_full)(_dev|_src)?.js/.test(n.src)) {
        if (/_(src|dev)\.js/g.test(n.src)) {
            t.suffix = '_src';
        }
        if ((p = n.src.indexOf('?')) != -1) {
            t.query = n.src.substring(p + 1);
        }

        t.baseURL = n.src.substring(0, n.src.lastIndexOf('/'));

        // If path to script is relative and a base href was found add that one infront
        // the src property will always be an absolute one on non IE browsers and IE 8
        // so this logic will basically only be executed on older IE versions
        if (base &amp;&amp; t.baseURL.indexOf('://') == -1 &amp;&amp; t.baseURL.indexOf('/') !== 0) {
            t.baseURL = base + t.baseURL;
        }
        return t.baseURL;
  }
  return null;
}[/code]

With this hack, console error yelling <code>tinyMCE is undefined</code> is gone. No more error but the editor still does not work, TinyMCE waits for the document to be ready before calling its render phase. Let's fake it by flagging when we're coming from a Wicket Ajax request. We simply add an attribute to tinyMCE object : in the <code>_init()</code> method

[code lang="js"]
t.isAjax = false;
[/code]

We flag in the <code>getBase(n)</code> when we come from Wicket Ajax (when we get something like <code>&lt;script src_=""&gt;&lt;/script&gt;</code>)

[code lang="js" highlight="2"]if (src_) {
    t.isAjax = true;
    n.src = src_;
}[/code]

and we set the <code>domLoaded</code> flag to the newly introduced attribute at the end of the JavaScript file :

[code lang="js"]
tinymce.dom.Event.domLoaded = tinymce.isAjax;
[/code]

This way, TinyMCE calls its render phase directly when we call <code>init()</code> on tinyMCE object. This call is done by Wicket when the dom is ready and then we finally got TinyMCE working even when coming from an ajax javascript inclusion. The only thing you need to do in order for this to work in deployment mode is to compress tiny_mce_src.js to tiny_mce.js with this patch.

You can find the resulting  <code>tiny_mce_src.js</code> <a href="http://gist.github.com/643272">here</a>.<!--:-->

      <footer class="entry-meta">
        <span class="entry-tags"><a href="/tags/index.html#java" title="Pages tagged java" rel="tag" class="tag">java</a><a href="/tags/index.html#javascript" title="Pages tagged javascript" rel="tag" class="tag">javascript</a><a href="/tags/index.html#tinymce" title="Pages tagged tinymce" rel="tag" class="tag">tinymce</a><a href="/tags/index.html#wicket" title="Pages tagged wicket" rel="tag" class="tag">wicket</a></span>
        <span><a href="/.wicket/wicket-1-4-9-tinymce" rel="bookmark" title="Wicket 1.4.x - TinyMCE" itemprop="url">Wicket 1.4.x - TinyMCE</a></span>
        was published on <span class="entry-date date published updated"><time datetime="2010-10-24T00:00:00-04:00" itemprop="datePublished">October 24, 2010</span></time>
        
        <span class="author vcard" itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name" class="fn"><a href="/about" title="About Your Name" itemprop="url">Your Name</a></span></span>
        
      </footer>
    </div><!-- /.entry-content -->
    
    
    <div class="read-more">
      
        <div class="read-more-header">
          <a href="" class="read-more-btn">Read More</a>
        </div><!-- /.read-more-header -->
        <div class="read-more-content">
          <h3><a href="/.android/android-switcher-widget" title="Android Switcher Widget">Android Switcher Widget</a></h3>
          <p>Heya all,I am trying to revive this blog from a long period of sleep. Let's start today with a little Java trick I made to have a working...&hellip; <a href="/.android/android-switcher-widget">Continue reading</a></p>
        </div><!-- /.read-more-content -->
      
      <div class="read-more-list">
        
          <div class="list-item">
            <h4><a href="/.java/.maven/work/getting-source-revision-for-a-deployed-app-using-maven-and-a-servlet" title="Getting source revision for a deployed app using Maven and a Servlet">Getting source revision for a deployed app using Maven and a Servlet</a></h4>
            <span>Published on November 01, 2010</span>
          </div><!-- /.list-item -->
        
          <div class="list-item">
            <h4><a href="/.java/work/glassfish-v3-custom-log-levels" title="Glassfish v3.x - custom log levels">Glassfish v3.x - custom log levels</a></h4>
            <span>Published on November 02, 2010</span>
          </div><!-- /.list-item -->
        
      </div><!-- /.read-more-list -->
      
    </div><!-- /.read-more -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2013 Your Name. Powered by <a href="http://jekyllrb.com">Jekyll</a> using the <a href="http://mademistakes.com/">HPSTR Theme</a>.</span>
  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="/assets/js/scripts.min.js"></script>

	        

</body>
</html>
