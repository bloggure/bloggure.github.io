<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Bloggure - Glassfish 3.x - Jersey with bundled dependencies</title>
  <meta name="author" content="Bloggure" />
  <meta name="description" content="The blog of Bloggure" />
  <link rel="canonical" href="http://bloggure.info/.java/work/2011/07/18/glassfish-3-x-jersey-with-bundled-dependencies.html" />

  <link href="//fonts.googleapis.com/css?family=Open+Sans:600,800" rel="stylesheet" type="text/css">
  <link rel="shortcut icon" href="/favicon.png">
  <link rel="alternate" type="application/rss+xml" title="Bloggure" href="http://bloggure.info/atom.xml" />

  <link rel="stylesheet" href="/assets/css/all.css">
<!--[if IE 7]>
  <link rel="stylesheet" href="/assets/css/font-awesome-ie7.min.css">
<![endif]-->
</head>
<body>
  <div class="container">
    <div class="four columns sidebar">
      <nav>
  <a href="/">
    <img src="/logo.png" id="logo" alt="Blog logo"/>
  </a>
  <h2><a href="/">Bloggure</a></h2>
  <hr/>
  <ul>
  <p>localhosting since 2005</p>
  <hr/>
  <div>
    <div id="social">
      Follow us:
<div id="stalker">
  
  <a title="bloggure on Github" href="http://github.com/bloggure">
    <i class="icon-github-sign"></i>
  </a>
  

  
  <a title="bloggure on Hacker News" href="http://news.ycombinator.com/user?id=bloggure">
    <i class="icon-sign-blank"></i>
    <span class="icon-overlay icon-hn">Y</span>
  </a>
  

  
  <a title="bloggure on Twitter" href="http://twitter.com/bloggure">
    <i class="icon-twitter-sign"></i>
  </a>
  

  <a title="RSS feed" id="rss" href="/atom.xml">
    <i class="icon-rss-sign"></i>
  </a>
</div>
    </div>
  </div>
  </ul>
</nav>
    </div>

    <div class="eleven columns content">
      <p class="meta">
  July 18, 2011 
  <a href="/">
    <i class="home icon-home"></i>
  </a>
</p>

<h1 class="title">Glassfish 3.x - Jersey with bundled dependencies</h1>

<div id="post">
  <!--:en--><a rel="attachment wp-att-71" href="http://www.bloggure.info/work/glassfish-v3-custom-log-levels.html/attachment/glassfish"><img class="size-full wp-image-71 alignright" title="glassfish" src="http://www.bloggure.info/wp-content/uploads/2010/11/glassfish.png" alt="" width="92" height="50" /></a>

I just wanted to make a small post regarding an issue I spent almost a day getting rid off. I have a quite typical web architecture :
<ul>
	<li>jar module encapsulating business logic (EJBs)</li>
	<li>war module providing front end web access</li>
	<li>war module for web service access (using JAX-RS)</li>
</ul>
<h2>The headache</h2>
Each war module depends on the ejb-client counterpart present in WEB-INF/lib. The problem I faced is that my @EJB injections was raising ClassNotFoundExceptions. I tried bypassing automatic injection with manual JNDI lookups but the same errors occurred. Playing with the debugger I found that the jars present in lib folder were not added into the web application's classloader.
<h2>The workaround</h2>
I spent a lot of time trying many things to fix this and found out the trick by downloading Jersey's sample. You simply have to have a sun-web.xml with the following content :
<pre class="brush: xml"><sun-web-app>
  <class-loader delegate="true"></class-loader>
</sun-web-app>
</pre>
I hope it will help someone else!<!--:--><!--:fr--><a rel="attachment wp-att-71" href="http://www.bloggure.info/work/glassfish-v3-custom-log-levels.html/attachment/glassfish"><img class="size-full wp-image-71 alignright" title="glassfish" src="http://www.bloggure.info/wp-content/uploads/2010/11/glassfish.png" alt="" width="92" height="50" /></a>
Je voulais juste faire un petit billet concernant un soucis que j'ai mis quasiment une journée à résoudre. J'ai une application web avec une architecture assez commune : 
<ul>
	<li>un module métier (packagé dans un jar composé d'EJBs)</li>
	<li>un module web frontal (packagé dans un war)</li>
	<li>un module web pour les web services (utilisant exclusivement JAX-RS, packagé dans un war)</li>
</ul>
<h2>Le casse tête!</h2>
Chaque module war a une dépendance sur la partie ejb cliente du module métier (présents dans le WEB-INF/lib donc). Le problème que j'ai rencontré est que l'injection de dépendances dans mon module web-service (@EJB) lève des ClassNotFoundExceptions. J'ai essayé de passer outre l'injection automatique par le conteneur en faisant une recherche manuelle dans l'annuaire JNDI mais ceci s'est soldé par un échec avec la même erreur à la clef.
En jouant avec le débuggueur, je me suis rendu compte que les jars présents dans le dossier lib n'étaient pas ajoutés au classloader de l'application web.
<h2>La solution</h2>
J'ai passé longtemps à essayer beaucoup de choses pour corriger ce problème et j'ai trouvé l'astuce dans les exemples d'utilisation de Jersey.<br/>
Il suffit simplement d'avoir un fichier sun-web.xml avec le contenu suivant :
<pre class="brush: xml"><sun-web-app>
  <class-loader delegate="true"></class-loader>
</sun-web-app>
</pre>
J'espère aider quelqu'un d'autre avec cette astuce !<!--:-->

</div>

<!-- <div id="related">
  <h3>Related Posts</h3>
  <ul class="posts">
    
    <li>
      <span>24 Oct 2010 &raquo;</span> <a href="/.wicket/2010/10/24/wicket-1-4-9-tinymce.html">Wicket 1.4.x - TinyMCE</a>
    </li>
    
    <li>
      <span>29 Oct 2010 &raquo;</span> <a href="/.android/2010/10/29/android-switcher-widget.html">Android Switcher Widget</a>
    </li>
    
    <li>
      <span>01 Nov 2010 &raquo;</span> <a href="/.java/.maven/work/2010/11/01/getting-source-revision-for-a-deployed-app-using-maven-and-a-servlet.html">Getting source revision for a deployed app using Maven and a Servlet</a>
    </li>
    
  </ul>
</div> -->
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'thereisnoplacelike1'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    
    
      <div class="footer">
        <div class="disclaimer">
  
  <p>
    The postings on this site are my own and don't necessarily represent my 
    employer’s positions, strategies or opinions.
  </p>
  

  <p>
    © Bloggure, 2013 &mdash; built with Jekyll using Lagom theme
  </p>
</div>
      </div>
    </div>
  </div>


<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-xxxx-x']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

</body>
</html>