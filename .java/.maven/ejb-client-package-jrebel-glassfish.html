<!DOCTYPE html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en">
  <!--<![endif]-->
  <head>
    <meta charset="utf-8" />
    <title>ejb-client package + JRebel + Glassfish &#8211; Bloggure</title>
    <meta
      name="description"
      content="Multi author blog about programming, computing and geek stuff"
    />
    <meta
      name="keywords"
      content="ejb, github, glassfish, java, jrebel, maven"
    />

    <!-- Open Graph -->
    <meta property="og:locale" content="en_US" />
    <meta property="og:type" content="article" />
    <meta
      property="og:title"
      content="ejb-client package + JRebel + Glassfish"
    />
    <meta
      property="og:description"
      content="Multi author blog about programming, computing and geek stuff"
    />
    <meta
      property="og:url"
      content="http://www.bloggure.info/.java/.maven/ejb-client-package-jrebel-glassfish"
    />
    <meta property="og:site_name" content="Bloggure" />

    <link
      rel="canonical"
      href="http://www.bloggure.info/.java/.maven/ejb-client-package-jrebel-glassfish"
    />
    <link
      href="http://www.bloggure.info/feed.xml"
      type="application/atom+xml"
      rel="alternate"
      title="Bloggure Feed"
    />

    <!-- http://t.co/dKP3o1e -->
    <meta name="HandheldFriendly" content="True" />
    <meta name="MobileOptimized" content="320" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- For all browsers -->
    <link
      rel="stylesheet"
      href="http://www.bloggure.info/assets/css/main.css"
    />
    <!-- Webfonts -->
    <link
      href="https://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic"
      rel="stylesheet"
      type="text/css"
    />

    <meta http-equiv="cleartype" content="on" />

    <!-- Load Modernizr -->
    <script src="http://www.bloggure.info/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

    <!-- Icons -->
    <!-- 16x16 -->
    <link rel="shortcut icon" href="http://www.bloggure.info/favicon.ico" />
    <!-- 32x32 -->
    <link rel="shortcut icon" href="http://www.bloggure.info/favicon.png" />
    <!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
    <link
      rel="apple-touch-icon-precomposed"
      href="http://www.bloggure.info/images/apple-touch-icon-precomposed.png"
    />
    <!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
    <link
      rel="apple-touch-icon-precomposed"
      sizes="72x72"
      href="http://www.bloggure.info/images/apple-touch-icon-72x72-precomposed.png"
    />
    <!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
    <link
      rel="apple-touch-icon-precomposed"
      sizes="114x114"
      href="http://www.bloggure.info/images/apple-touch-icon-114x114-precomposed.png"
    />
    <!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
    <link
      rel="apple-touch-icon-precomposed"
      sizes="144x144"
      href="http://www.bloggure.info/images/apple-touch-icon-144x144-precomposed.png"
    />
  </head>

  <body id="post">
    <!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->

    <div class="entry-header">
      <header class="header-title">
        <div class="header-title-wrap">
          <h1 class="entry-title" itemprop="name">
            <a href="http://www.bloggure.info/">Bloggure</a>
          </h1>
        </div>
        <!-- /.header-title-wrap -->
      </header>
    </div>

    <div id="main" role="main">
      <article class="hentry">
        <div class="entry-content">
          <header>
            <div class="entry-meta">
              <span class="entry-date date published updated"
                ><time
                  datetime="2011-08-09T00:00:00+02:00"
                  itemprop="datePublished"
                  ><a
                    href="http://www.bloggure.info/.java/.maven/ejb-client-package-jrebel-glassfish"
                    >August 09, 2011</a
                  ></time
                ></span
              ><span
                class="author vcard"
                itemprop="author"
                itemscope
                itemtype="http://schema.org/Person"
                ><span itemprop="name" class="fn"
                  ><a
                    href="http://www.bloggure.info/cgatay"
                    title="About cgatay"
                    itemprop="url"
                    >cgatay</a
                  ></span
                ></span
              >&nbsp; &bull; &nbsp;<span class="entry-comments"
                ><a
                  href="http://www.bloggure.info/.java/.maven/ejb-client-package-jrebel-glassfish#disqus_thread"
                  >Comment</a
                ></span
              >
            </div>
            <!-- /.entry-meta -->

            <h1 class="entry-title" itemprop="name">
              <a
                href="http://www.bloggure.info/.java/.maven/ejb-client-package-jrebel-glassfish"
                rel="bookmark"
                title="ejb-client package + JRebel + Glassfish"
                itemprop="url"
                >ejb-client package + JRebel + Glassfish</a
              >
            </h1>
          </header>
          <!--:en--><img
            src="/images/uploads/2011/08/logo_jrebel.png"
            alt=""
            title="JRebel"
            width="146"
            height="40"
            class="alignright size-full wp-image-340"
          />
          <h2>JRebel ?</h2>
          <p>
            I use
            <a href="http://www.zeroturnaround.com/jrebel/" title="JRebel"
              >JRebel</a
            >
            to speed up my development. It is a really impressive tool allowing
            to develop full blended Java EE application as you would develop in
            PHP. No redeploy, at the cost of a little slow-down in development
            mode. The tool does what it says, and it's worth the price ! The
            JRebel plugin for maven does the job very well by generating the
            <code>rebel.xml</code> file that does the magic.
          </p>

          <h2>What's the deal ?</h2>
          <p>
            Although JRebel is an awesome tool, there is some magic within, and,
            in special corner cases it might not work as expected. In my case I
            have a quite typical web application split in multiple parts:
          </p>
          <ul>
            <li>a web application (war)</li>
            <li>an ejb module (jar)</li>
            <li>other modules not involved in my problem</li>
          </ul>
          <p>
            The web application includes, in its
            <code>WEB-INF/lib</code> folder, the <em>ejb-client</em> artifact of
            my ejb module. To make it clear, <em>ejb-client</em> artifact is
            typically the jar containing the interfaces to be used by the client
            module(s).
          </p>

          <p>
            The problem I had was that JRebel magic was reloading too much
            things : in fact, it reloaded classes even if they were not in the
            <em>ejb-client</em>. My application container (Glassfish 3.x) was
            not very keen on this thing. I opened
            <a
              href="http://www.zeroturnaround.com/forum/topic.php?id=1315"
              title="JRebel + Glassfish 3.1 + ejb-client + Wicket"
              >a thread on ZeroTurnAround's forum</a
            >
            and the answer I got is that I have to find a way to ignore files in
            my <em>ejb-client</em> module. By digging in
            <em>maven-ejb-plugin</em>, I didn't find anything to rename a file
            in the <em>ejb-client</em> module, and I didn't find a parameter to
            pass to JRebel to specify which filenames can contain its
            configuration.
          </p>
          <!--:--><!--:fr<a href="http://www.bloggure.info/java-work/ejb-client-package-jrebel-glassfish.html/attachment/logo_jrebel" rel="attachment wp-att-340"><img src="/images/uploads/2011/08/logo_jrebel.png" alt="" title="JRebel" width="146" height="40" class="alignright size-full wp-image-340" /></a>
<h2>JRebel ?</h2>
J'utilise <a href="http://www.zeroturnaround.com/jrebel/" title="JRebel">JRebel</a> pour accélerer mon cycle de développement. C'est un outil impressionnant qui permet de développer une application Java EE comme du PHP. Pas de redéploiement, tout ça au prix d'une petite perte de performances en mode développement. L'outil fait ce qu'il promet, et vaut réellement son prix ! Le plugin JRebel pour maven fait exactement ce qu'on attend de lui en générant automatiquement le fichier <code>rebel.xml</code> qui s'occupe de la magie.

<h2>Quel est le problème alors ?</h2>
Bien que JRebel soit un outil génial, il y a un peu trop de magie à l'intérieur et, dans certains cas particuliers, il se peut que ça ne marche pas tout à fait comme attendu. Dans mon cas, j'ai une application web assez classique divisée en plusieurs modules :
<ul>
   <li>une application web (war)</li>
   <li>un module ejb (jar)</li>
   <li>d'autres modules non impliqués dans mon problème</li>
</ul>
La web application inclut, dans son dossier <code>WEB-INF/lib</code>, l'artifact <em>ejb-client</em> de mon module ejb. Pour être clair, l'artifact <em>ejb-client</em> est généralement le jar contenant les interfaces publiées permettant l'utilisation des ejb par les modules clients.

Le problème que j'ai eu était que la magie de JRebel entraînait le rechargemenet de trop de classes. En fait, JRebel rechargeait des classes qui n'étaient même pas dans mon artifact <em>ejb-client</em>. Mon container d'application (Glassfish 3.x) n'aimait pas trop ce comportement. J'ai donc ouvert <a href="http://www.zeroturnaround.com/forum/topic.php?id=1315" title="JRebel + Glassfish 3.1 + ejb-client + Wicket">un sujet sur le forum de ZeroTurnAround</a> où j'ai eu une réponse me disant de trouver un moyen d'exclure les fichiers que je ne voulais pas voir rechargés dans mon module <em>ejb-client</em>.

J'ai donc fouiné dans <em>maven-ejb-plugin</em>, mais je n'ai rien trouvé permettant de renommer un fichier dans l'artifact <em>ejb-client</em>. Je n'ai pas non plus trouvé de paramètre spécifique à passer à JRebel pour lui spécifier quels noms de fichier il doit monitorer pour trouver sa configuration.
--><!--more--><!--:en-->
          <h2>The solution</h2>
          <p>
            I patched the <em>maven-ejb-plugin</em> to fulfill my needs. It is
            done in a very simple and probably not optimal way. The trick is to
            create a file named <code>client.rebel.xml</code> containing the
            JRebel configuration to be used by the <em>ejb-client</em> module.
            At compile time, when building the <em>ejb-client</em> artifact,
            Maven will automatically replace the auto-generated
            <code>rebel.xml</code> by the <code>client.rebel.xml</code>.
          </p>
          <p>The piece of code corresponding to the patch is the following:</p>
          <figure class="highlight">
            <pre><code class="language-java" data-lang="java"><span></span><span class="n">File</span> <span class="n">file</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">outputDirectory</span><span class="o">,</span> <span class="s">&quot;client.rebel.xml&quot;</span><span class="o">);</span>
<span class="k">if</span> <span class="o">(</span><span class="n">file</span><span class="o">.</span><span class="na">exists</span><span class="o">()){</span>
   <span class="n">getLog</span><span class="o">().</span><span class="na">info</span><span class="o">(</span><span class="s">&quot;Found a client.rebel.xml, renaming it to rebel.xml and put it into destination ejb-client archive&quot;</span><span class="o">);</span>
   <span class="n">clientArchiver</span><span class="o">.</span><span class="na">getArchiver</span><span class="o">().</span><span class="na">addFile</span><span class="o">(</span><span class="n">file</span><span class="o">,</span> <span class="s">&quot;rebel.xml&quot;</span><span class="o">);</span>
   <span class="n">List</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">(</span><span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">excludes</span><span class="o">));</span>
   <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;**/client.rebel.xml&quot;</span><span class="o">);</span>
   <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;**/rebel.xml&quot;</span><span class="o">);</span>
   <span class="n">excludes</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">[])</span> <span class="n">list</span><span class="o">.</span><span class="na">toArray</span><span class="o">(</span><span class="n">EMPTY_STRING_ARRAY</span><span class="o">);</span>
<span class="o">}</span></code></pre>
          </figure>
          <p>
            This is the only modification done to the original
            <em>maven-ejb-plugin</em> (aside the modified version number in
            <code>pom.xml</code> to clearly identify my fork) so it will surely
            be easy to port to the another version.
          </p>

          <h2>How to use ?</h2>
          <p>
            I imported my little fork of
            <a
              href="https://github.com/CedricGatay/maven-ejb-plugin-jrebel"
              title="maven-ejb-plugin-jrebel"
              >maven-ejb-plugin on my github account</a
            >. You can freely use it, fork it, improve it if you need to. If I
            find the time I could make it better by providing a much more
            flexible system (<code>client.rebel.xml</code> to
            <code>rebel.xml</code> hard coded hurts me while reading this
            code...).
          </p>
          <p>
            To use this, if you need to, you simply need to clone the sources,
            build this project and set the <em>maven-ejb-plugin</em> version to
            your pom like the following :
          </p>
          <figure class="highlight">
            <pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;build&gt;</span>
 <span class="nt">&lt;plugins&gt;</span>
   <span class="nt">&lt;plugin&gt;</span>
     <span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
     <span class="nt">&lt;artifactId&gt;</span>maven-ejb-plugin<span class="nt">&lt;/artifactId&gt;</span>
     <span class="nt">&lt;version&gt;</span>2.3-jrebel<span class="nt">&lt;/version&gt;</span>
  <span class="nt">&lt;/plugin&gt;</span>
 <span class="nt">&lt;/plugins&gt;</span>
<span class="nt">&lt;/build&gt;</span></code></pre>
          </figure>
          <p>
            If it works, you will see in your build log a line telling "<code
              >Found a client.rebel.xml, renaming it to rebel.xml and put it
              into destination ejb-client archive</code
            >". If everything goes well, the problem disappears and the next
            step is to deploy the artifact to your company hosted maven
            repository to let your entire team use this.
          </p>

          <p>Hope it'll help...</p>
          <!--:--><!--:fr
<h2>La solution</h2>
J'ai patché <em>maven-ejb-plugin</em> pour correspondre à mon besoin. C'est fait de façon très simple et certainement pas la plus optimale. L'astuce est de créer un fichier nommé <code>client.rebel.xml</code> contenant la configuration de  JRebel correspondant au module <em>ejb-client</em>. À la compilation, lors du build de la partie <em>ejb-client</em>, maven va automatiquement remplacer le <code>rebel.xml</code> autogénéré par le <code>client.rebel.xml</code>.
La partie de code correspondant au patch est la suivante :
<pre class="brush: java">
File file = new File(outputDirectory, "client.rebel.xml");
if (file.exists()){
   getLog().info("Found a client.rebel.xml, renaming it to rebel.xml and put it into destination ejb-client archive");
   clientArchiver.getArchiver().addFile(file, "rebel.xml");
   List list = new ArrayList(Arrays.asList(excludes));
   list.add("**/client.rebel.xml");
   list.add("**/rebel.xml");
   excludes = (String[]) list.toArray(EMPTY_STRING_ARRAY);
}
</pre>
C'est la seule modification faite au plugin original <em>maven-ejb-plugin</em> (en plus du numéro de version modifié dans le <code>pom.xml</code> pour identifier clairement ce fork), il devrait donc être facile de l'appliquer sur les autres versions du plugin.<br/>

<h2>Comment l'utiliser ?</h2>
J'ai importé ce petit fork de <a href="https://github.com/CedricGatay/maven-ejb-plugin-jrebel" title="maven-ejb-plugin-jrebel">maven-ejb-plugin sur mon compte github</a>. Vous pouvez l'utiliser, le modifier, l'améliorer librement si vous en avez besoin. Si je trouve le temps je pourrais le rendre un peu plus flexible (<code>client.rebel.xml</code> vers <code>rebel.xml</code> en dur dans le code me pique les yeux...).
Pour l'utiliser, il est juste nécessaire de cloner les sources, de le compiler en utilisant maven et de mettre à jour la version du plugin <em>maven-ejb-plugin</em> dans votre pom :
<pre class="brush:xml">
<build>
 <plugins>
   <plugin>
     <groupId>org.apache.maven.plugins</groupId>
     <artifactId>maven-ejb-plugin</artifactId>
     <version>2.3-jrebel</version>
  </plugin>
 </plugins>
</build>
</pre>
Si tout fonctionne correctement, vous devriez voir dans vos logs de compilation une ligne disant "<code>Found a client.rebel.xml, renaming it to rebel.xml and put it into destination ejb-client archive</code>". Si tout se passe bien, le problème aura disparu et vous n'aurez plus qu'à déployer l'artifact sur votre repository maven d'entreprise pour que toute votre équipe puisse se débarasser de cet ennuyeux soucis.

En espérant en aider certains...-->

          <footer class="entry-meta">
            <span class="entry-tags"
              ><a
                href="http://www.bloggure.info/tags/#ejb"
                title="Pages tagged ejb"
                class="tag"
                ><span class="term">ejb</span></a
              ><a
                href="http://www.bloggure.info/tags/#github"
                title="Pages tagged github"
                class="tag"
                ><span class="term">github</span></a
              ><a
                href="http://www.bloggure.info/tags/#glassfish"
                title="Pages tagged glassfish"
                class="tag"
                ><span class="term">glassfish</span></a
              ><a
                href="http://www.bloggure.info/tags/#java"
                title="Pages tagged java"
                class="tag"
                ><span class="term">java</span></a
              ><a
                href="http://www.bloggure.info/tags/#jrebel"
                title="Pages tagged jrebel"
                class="tag"
                ><span class="term">jrebel</span></a
              ><a
                href="http://www.bloggure.info/tags/#maven"
                title="Pages tagged maven"
                class="tag"
                ><span class="term">maven</span></a
              ></span
            >

            <div class="social-share">
              <ul class="socialcount socialcount-small inline-list">
                <li class="facebook">
                  <a
                    href="https://www.facebook.com/sharer/sharer.php?u=http://www.bloggure.info/.java/.maven/ejb-client-package-jrebel-glassfish"
                    title="Share on Facebook"
                    ><span class="count"
                      ><i class="fa fa-facebook-square"></i> Like</span
                    ></a
                  >
                </li>
                <li class="twitter">
                  <a
                    href="https://twitter.com/intent/tweet?text=http://www.bloggure.info/.java/.maven/ejb-client-package-jrebel-glassfish"
                    title="Share on Twitter"
                    ><span class="count"
                      ><i class="fa fa-twitter-square"></i> Tweet</span
                    ></a
                  >
                </li>
              </ul>
            </div>
            <!-- /.social-share -->
          </footer>
        </div>
        <!-- /.entry-content -->
        <section id="disqus_thread"></section>
        <!-- /#disqus_thread -->
        <div class="read-more">
          <div class="read-more-header">
            <a
              href="http://www.bloggure.info/www/a-programmers-life"
              class="read-more-btn"
              >Read More</a
            >
          </div>
          <!-- /.read-more-header -->
          <div class="read-more-content">
            <h3>
              <a
                href="http://www.bloggure.info/SwiftUI-UIKit_Interop"
                title="SwiftUI UIKit Interop"
                >SwiftUI UIKit Interop</a
              >
            </h3>
            <p>
              Now that iOS13 is available for more than year, we can start to
              set it as a lower bound for our deployments.This allows us to play
              with a...&hellip;
              <a href="http://www.bloggure.info/SwiftUI-UIKit_Interop"
                >Continue reading</a
              >
            </p>
          </div>
          <!-- /.read-more-content -->

          <div class="read-more-list">
            <div class="list-item">
              <h4>
                <a
                  href="http://www.bloggure.info/XCodeUnitTestInheritance"
                  title="XCode unit test and inheritance"
                  >XCode unit test and inheritance</a
                >
              </h4>
              <span>Published on December 02, 2020</span>
            </div>
            <!-- /.list-item -->

            <div class="list-item">
              <h4>
                <a
                  href="http://www.bloggure.info/Revival"
                  title="Bloggure revival"
                  >Bloggure revival</a
                >
              </h4>
              <span>Published on December 01, 2020</span>
            </div>
            <!-- /.list-item -->
          </div>
          <!-- /.read-more-list -->
        </div>
        <!-- /.read-more -->
      </article>
    </div>
    <!-- /#main -->

    <div class="footer-wrapper">
      <footer role="contentinfo">
        <span
          >&copy; 2020 . Powered by
          <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using a theme
          based on
          <a
            href="https://mademistakes.com/work/hpstr-jekyll-theme/"
            rel="nofollow"
            >HPSTR</a
          >.</span
        >
      </footer>
    </div>
    <!-- /.footer-wrapper -->

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script>
      window.jQuery ||
        document.write(
          '<script src="http://www.bloggure.info/assets/js/vendor/jquery-1.9.1.min.js"><\/script>'
        );
    </script>
    <script src="http://www.bloggure.info/assets/js/scripts.min.js"></script>

    <!-- Asynchronous Google Analytics snippet -->
    <script>
      (function (i, s, o, g, r, a, m) {
        i["GoogleAnalyticsObject"] = r;
        (i[r] =
          i[r] ||
          function () {
            (i[r].q = i[r].q || []).push(arguments);
          }),
          (i[r].l = 1 * new Date());
        (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m);
      })(
        window,
        document,
        "script",
        "//www.google-analytics.com/analytics.js",
        "ga"
      );

      ga("create", "UA-11718843-3", "auto");
      ga("require", "linkid", "linkid.js");
      ga("send", "pageview");
    </script>

    <script type="text/javascript">
      /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
      var disqus_shortname = "thereisnoplacelike1"; // required: replace example with your forum shortname

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function () {
        var dsq = document.createElement("script");
        dsq.type = "text/javascript";
        dsq.async = true;
        dsq.src = "//" + disqus_shortname + ".disqus.com/embed.js";
        (
          document.getElementsByTagName("head")[0] ||
          document.getElementsByTagName("body")[0]
        ).appendChild(dsq);
      })();

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function () {
        var s = document.createElement("script");
        s.async = true;
        s.type = "text/javascript";
        s.src = "//" + disqus_shortname + ".disqus.com/count.js";
        (
          document.getElementsByTagName("HEAD")[0] ||
          document.getElementsByTagName("BODY")[0]
        ).appendChild(s);
      })();
    </script>
    <noscript
      >Please enable JavaScript to view the
      <a href="http://disqus.com/?ref_noscript"
        >comments powered by Disqus.</a
      ></noscript
    >
    <a href="http://disqus.com" class="dsq-brlink"
      >comments powered by <span class="logo-disqus">Disqus</span></a
    >
  </body>
</html>
