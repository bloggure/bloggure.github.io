<!DOCTYPE html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en">
  <!--<![endif]-->
  <head>
    <meta charset="utf-8" />
    <title>
      Play application on Centos/RedHat in production mode &#8211; Bloggure
    </title>
    <meta
      name="description"
      content="Multi author blog about programming, computing and geek stuff"
    />
    <meta name="keywords" content="" />

    <!-- Open Graph -->
    <meta property="og:locale" content="en_US" />
    <meta property="og:type" content="article" />
    <meta
      property="og:title"
      content="Play application on Centos/RedHat in production mode"
    />
    <meta
      property="og:description"
      content="Multi author blog about programming, computing and geek stuff"
    />
    <meta
      property="og:url"
      content="http://www.bloggure.info/.java/.scala/.shell/ci/shelf/centos-redhat-play-application-production-mode"
    />
    <meta property="og:site_name" content="Bloggure" />

    <link
      rel="canonical"
      href="http://www.bloggure.info/.java/.scala/.shell/ci/shelf/centos-redhat-play-application-production-mode"
    />
    <link
      href="http://www.bloggure.info/feed.xml"
      type="application/atom+xml"
      rel="alternate"
      title="Bloggure Feed"
    />

    <!-- http://t.co/dKP3o1e -->
    <meta name="HandheldFriendly" content="True" />
    <meta name="MobileOptimized" content="320" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- For all browsers -->
    <link
      rel="stylesheet"
      href="http://www.bloggure.info/assets/css/main.css"
    />
    <!-- Webfonts -->
    <link
      href="https://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic"
      rel="stylesheet"
      type="text/css"
    />

    <meta http-equiv="cleartype" content="on" />

    <!-- Load Modernizr -->
    <script src="http://www.bloggure.info/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

    <!-- Icons -->
    <!-- 16x16 -->
    <link rel="shortcut icon" href="http://www.bloggure.info/favicon.ico" />
    <!-- 32x32 -->
    <link rel="shortcut icon" href="http://www.bloggure.info/favicon.png" />
    <!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
    <link
      rel="apple-touch-icon-precomposed"
      href="http://www.bloggure.info/images/apple-touch-icon-precomposed.png"
    />
    <!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
    <link
      rel="apple-touch-icon-precomposed"
      sizes="72x72"
      href="http://www.bloggure.info/images/apple-touch-icon-72x72-precomposed.png"
    />
    <!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
    <link
      rel="apple-touch-icon-precomposed"
      sizes="114x114"
      href="http://www.bloggure.info/images/apple-touch-icon-114x114-precomposed.png"
    />
    <!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
    <link
      rel="apple-touch-icon-precomposed"
      sizes="144x144"
      href="http://www.bloggure.info/images/apple-touch-icon-144x144-precomposed.png"
    />
  </head>

  <body id="post">
    <!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->

    <div class="entry-header">
      <header class="header-title">
        <div class="header-title-wrap">
          <h1 class="entry-title" itemprop="name">
            <a href="http://www.bloggure.info/">Bloggure</a>
          </h1>
        </div>
        <!-- /.header-title-wrap -->
      </header>
    </div>

    <div id="main" role="main">
      <article class="hentry">
        <div class="entry-content">
          <header>
            <div class="entry-meta">
              <span class="entry-date date published updated"
                ><time
                  datetime="2013-07-25T00:00:00+02:00"
                  itemprop="datePublished"
                  ><a
                    href="http://www.bloggure.info/.java/.scala/.shell/ci/shelf/centos-redhat-play-application-production-mode"
                    >July 25, 2013</a
                  ></time
                ></span
              ><span
                class="author vcard"
                itemprop="author"
                itemscope
                itemtype="http://schema.org/Person"
                ><span itemprop="name" class="fn"
                  ><a
                    href="http://www.bloggure.info/tdebarochez"
                    title="About tdebarochez"
                    itemprop="url"
                    >tdebarochez</a
                  ></span
                ></span
              >&nbsp; &bull; &nbsp;<span class="entry-comments"
                ><a
                  href="http://www.bloggure.info/.java/.scala/.shell/ci/shelf/centos-redhat-play-application-production-mode#disqus_thread"
                  >Comment</a
                ></span
              >
            </div>
            <!-- /.entry-meta -->

            <h1 class="entry-title" itemprop="name">
              <a
                href="http://www.bloggure.info/.java/.scala/.shell/ci/shelf/centos-redhat-play-application-production-mode"
                rel="bookmark"
                title="Play application on Centos/RedHat in production mode"
                itemprop="url"
                >Play application on Centos/RedHat in production mode</a
              >
            </h1>
          </header>
          <em
            >Sorry english readers, the following post is only available in
            french !</em
          >
          <!--:fr-->
          <p>
            <strong>tl;dr </strong>: application
            <a title="play" href="http://www.playframework.com/">Play</a> (java
            ou <a href="http://www.scala-lang.org/">scala</a>) sur un serveur
            <a href="http://www.centos.org/">Centos</a> (ou
            <a href="http://fr.wikipedia.org/wiki/Red_Hat_Linux">Red Hat</a>)
            derrière un serveur
            <a title="nginx" href="http://nginx.org/">nginx</a>.
          </p>
          <h2>Script de démarrage/arrêt du daemon.</h2>
          <p>
            Lancer une application Play en dev est assez aisé :
            <code>$ play run</code>.
          </p>
          <p>
            Maintenant, si vous avez besoin de déployer votre application en
            production, il est plus confortable de considérer votre application
            comme un service à part entière du système. Il se peut aussi que
            vous ayez besoin de spécifier un port et une interface particulière
            pour pouvoir utiliser nginx comme front-end (en
            <a href="http://fr.wikipedia.org/wiki/Proxy_inverse"
              >reverse proxy</a
            >). Et évidement, à l'instar d'un environnement de développement,
            vous pourriez avoir besoin de compresser le JS et le CSS, et
            également de régler finement les en-têtes HTTP pour gérer
            correctement le cache.
          </p>
          <p>Tout d'abord le script de lancement du daemon :</p>
          <script src="https://gist.github.com/tdebarochez/6082933.js"></script>
          <p>
            Je me suis inspiré des deux gists ci-dessous. Le premier, pour
            RedHat, utilise le binaire de play pour lancer le processus
            principal. Cette méthode facile à utiliser en développement semble
            assez limité en paramètre (tout du moins, très peu documentée). La
            seconde méthode, pour <a href="http://www.debian.org/">Debian</a>,
            donne un bonne exemple d'une configuration un peu plus élaborée de
            l'exécution du daemon. Les paramètres en début de fichier parlent
            d'eux-mêmes, je vous laisse les découvrir et reste à votre
            disposition pour toute question.
          </p>
          <p>Source :</p>
          <ul>
            <li>
              <a href="https://gist.github.com/THemming/2173037"
                >https://gist.github.com/THemming/2173037</a
              >
              (script pour redhat)
            </li>
            <li>
              <a href="https://gist.github.com/leon/2204773"
                >https://gist.github.com/leon/2204773</a
              >
              (script pour debian)
            </li>
          </ul>
          <h2>Configuration de nginx</h2>
          <p>
            Sur un serveur web, il est souvent pratique de pouvoir faire tourner
            plusieurs applications utilisant des langages, des librairies, des
            frameworks, etc... hétérogènes (sur mon serveur, il y a
            l'application Play en scala, une application
            <a href="http://nodejs.org/">Nodejs</a> en
            <a href="http://coffeescript.org/">Coffescript</a> et une
            application <a href="http://php.net">PHP</a>/<a
              href="http://www.mysql.fr/"
              >MySQL</a
            >
            utilisant <a href="http://httpd.apache.org/">Apache</a>). C'est là
            que nginx intervient. Configuré en reverse-proxy, c'est lui qui
            écoutera sur le port 80 de votre serveur et en fonction du nom de
            domaine relayera les requêtes HTTP à l'application que vous avez
            choisis. Il vous suffit de configurer votre application en écoute
            sur un port libre en localhost et d'indiquer à nginx qu'en fonction
            du nom de domaine (à la manière des VirtualHost d'Apache), il doit
            transmettre ses requêtes sur ce port.
          </p>
          <p>
            Vous noterez une section fournissant un traitement particulier pour
            les fichiers statiques (js, css, png, jpg, etc...). En effet, je ne
            trouvais pas la configuration par défaut de play très satisfaisante
            pour diffuser ces fichiers. Il conviendra donc de copier tous les
            fichiers dans un dossier particulier au lancement de l'application
            (il faut également pensé à y placer les fichiers "compilé" des
            scripts utilisant un pre-processeurs : coffeescript,
            <a href="http://sass-lang.com">SASS/SCSS</a>,
            <a href="http://lesscss.org/">LESS</a>, etc...). Tous les fichiers
            dans ce dossier auront une durée de cache maximale afin de minimiser
            le nombre de requêtes au serveur (la requête la plus rapide est
            celle qui n'est pas faite). Cette technique a aussi l'avantage de
            décharger la JVM du traitement de ses fichiers, ils sont directement
            retourné par nginx.
          </p>
          <script src="https://gist.github.com/tdebarochez/6083089.js"></script>
          <h2>Compilation des fichiers statiques</h2>
          <p>
            Les pré-processeurs (Coffeescript, SASS, LESS, etc...) sont d'un
            grand confort pour le développement de la partie front-end d'une
            application web. Toutefois, il y a quelques détails qui ne faut pas
            négliger afin d'optimiser au maximum la distribution en HTTP de ces
            fichiers.
          </p>
          <p>
            Prenons comme exemple un fichier .coffee (Coffeescript). Lorsqu'en
            développement vous lancer votre serveur, play se charge de
            re-compiler automatiquement le fichier afin de desservir un fichier
            javascript au navigateur qui a demandé le fichier. Dans notre
            environnement, les fichiers statiques se trouvent tous dans un
            dossier <code>static/</code>. Il faut donc "traduire" ce fichier en
            javascript et le placer dans ce dossier (en respectant
            l'arborescence utilisée en développement) :
            <code
              >coffee -o static/javascripts/ -c
              app/assets/javascripts/*.coffee</code
            >.
          </p>
          <p>
            Ensuite, comme optimisation souvent préconnisée, il convient de
            "minifier" ces fichiers afin qu'ils soient le plus léger possible
            pendant le transport sur le réseau (qui peut-être une faible
            connexion 3g). Dans mon cas, j'ai utilisé
            <a href="https://github.com/yui/yuicompressor"
              ><code>yuicompressor</code></a
            >
            qui fonctionne bien. Il en existe certainement des mieux, je n'ai
            pas testé, mais celui-là fonctionne comme je veux.
          </p>
          <script src="https://gist.github.com/tdebarochez/6083307.js"></script>
          <p>
            Note : comme amélioration possible, il faudrait dans cette partie là
            renommer les fichiers par un nom de fichier contenant un hash
            représentant le contenu de ce fichier afin de palier à tout problème
            d'invalidation du cache.
          </p>
          <h2>Dans le futur</h2>
          <p>
            Pour parfaire le déploiement de l'application, sur un VCS
            <a href="http://git-scm.com/">git</a> par exemple, il serait
            pratique d'automatiser le redémarrage du serveur sur un hook
            post-commit. Pour éviter également une coupure de service, il
            faudrait également, lancer la nouvelle application sur un autre port
            et switcher sur la nouvelle instance uniquement avec un reload de
            nginx. Mais bon tout ça peut faire l'objet d'un autre article. :)
          </p>
          <p>
            <strong>Mise à jour du 29 juillet 2013</strong> : correction du
            script de lancement du daemon.
          </p>
          <!--:-->

          <footer class="entry-meta">
            <span class="entry-tags"></span>

            <div class="social-share">
              <ul class="socialcount socialcount-small inline-list">
                <li class="facebook">
                  <a
                    href="https://www.facebook.com/sharer/sharer.php?u=http://www.bloggure.info/.java/.scala/.shell/ci/shelf/centos-redhat-play-application-production-mode"
                    title="Share on Facebook"
                    ><span class="count"
                      ><i class="fa fa-facebook-square"></i> Like</span
                    ></a
                  >
                </li>
                <li class="twitter">
                  <a
                    href="https://twitter.com/intent/tweet?text=http://www.bloggure.info/.java/.scala/.shell/ci/shelf/centos-redhat-play-application-production-mode"
                    title="Share on Twitter"
                    ><span class="count"
                      ><i class="fa fa-twitter-square"></i> Tweet</span
                    ></a
                  >
                </li>
              </ul>
            </div>
            <!-- /.social-share -->
          </footer>
        </div>
        <!-- /.entry-content -->
        <section id="disqus_thread"></section>
        <!-- /#disqus_thread -->
        <div class="read-more">
          <div class="read-more-header">
            <a
              href="http://www.bloggure.info/.java/work/heroku-play-scala-compass-buildpack"
              class="read-more-btn"
              >Read More</a
            >
          </div>
          <!-- /.read-more-header -->
          <div class="read-more-content">
            <h3>
              <a
                href="http://www.bloggure.info/Module_Registration_Swift"
                title="Swift module registration"
                >Swift module registration</a
              >
            </h3>
            <p>
              Swift module registrationLet’s modularize our Swift code!I am
              using tuist for a while now in my projects. This tool was
              initially bring i...&hellip;
              <a href="http://www.bloggure.info/Module_Registration_Swift"
                >Continue reading</a
              >
            </p>
          </div>
          <!-- /.read-more-content -->

          <div class="read-more-list">
            <div class="list-item">
              <h4>
                <a
                  href="http://www.bloggure.info/Swift_VisibleForTesting_Macro"
                  title="Swift macro : @VisibleForTesting"
                  >Swift macro : @VisibleForTesting</a
                >
              </h4>
              <span>Published on April 19, 2024</span>
            </div>
            <!-- /.list-item -->

            <div class="list-item">
              <h4>
                <a
                  href="http://www.bloggure.info/iOS-DarkModeBackground-App-Switcher"
                  title="Dark Mode iOS Snapshot"
                  >Dark Mode iOS Snapshot</a
                >
              </h4>
              <span>Published on January 10, 2021</span>
            </div>
            <!-- /.list-item -->
          </div>
          <!-- /.read-more-list -->
        </div>
        <!-- /.read-more -->
      </article>
    </div>
    <!-- /#main -->

    <div class="footer-wrapper">
      <footer role="contentinfo">
        <span
          >&copy; 2025 . Powered by
          <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using a theme
          based on
          <a
            href="https://mademistakes.com/work/hpstr-jekyll-theme/"
            rel="nofollow"
            >HPSTR</a
          >.</span
        >
      </footer>
    </div>
    <!-- /.footer-wrapper -->

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script>
      window.jQuery ||
        document.write(
          '<script src="http://www.bloggure.info/assets/js/vendor/jquery-1.9.1.min.js"><\/script>'
        );
    </script>
    <script src="http://www.bloggure.info/assets/js/scripts.min.js"></script>

    <!-- Asynchronous Google Analytics snippet -->
    <script>
      (function (i, s, o, g, r, a, m) {
        i["GoogleAnalyticsObject"] = r;
        (i[r] =
          i[r] ||
          function () {
            (i[r].q = i[r].q || []).push(arguments);
          }),
          (i[r].l = 1 * new Date());
        (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m);
      })(
        window,
        document,
        "script",
        "//www.google-analytics.com/analytics.js",
        "ga"
      );

      ga("create", "UA-11718843-3", "auto");
      ga("require", "linkid", "linkid.js");
      ga("send", "pageview");
    </script>

    <script type="text/javascript">
      /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
      var disqus_shortname = "thereisnoplacelike1"; // required: replace example with your forum shortname

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function () {
        var dsq = document.createElement("script");
        dsq.type = "text/javascript";
        dsq.async = true;
        dsq.src = "//" + disqus_shortname + ".disqus.com/embed.js";
        (
          document.getElementsByTagName("head")[0] ||
          document.getElementsByTagName("body")[0]
        ).appendChild(dsq);
      })();

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function () {
        var s = document.createElement("script");
        s.async = true;
        s.type = "text/javascript";
        s.src = "//" + disqus_shortname + ".disqus.com/count.js";
        (
          document.getElementsByTagName("HEAD")[0] ||
          document.getElementsByTagName("BODY")[0]
        ).appendChild(s);
      })();
    </script>
    <noscript
      >Please enable JavaScript to view the
      <a href="http://disqus.com/?ref_noscript"
        >comments powered by Disqus.</a
      ></noscript
    >
    <a href="http://disqus.com" class="dsq-brlink"
      >comments powered by <span class="logo-disqus">Disqus</span></a
    >
  </body>
</html>
