<!DOCTYPE html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en">
  <!--<![endif]-->
  <head>
    <meta charset="utf-8" />
    <title>
      Rescue a VPS upgrade with chroot &#8211; Bloggure | There is no place like
      ::1
    </title>
    <meta
      name="description"
      content="Multi author blog about programming, computing and geek stuff"
    />
    <meta name="keywords" content="debian, vps, upgrade, chroot" />

    <!-- Open Graph -->
    <meta property="og:locale" content="en_US" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Rescue a VPS upgrade with chroot" />
    <meta
      property="og:description"
      content="Multi author blog about programming, computing and geek stuff"
    />
    <meta
      property="og:url"
      content="http://www.bloggure.info/rescue-a-vps-with-chroot"
    />
    <meta
      property="og:site_name"
      content="Bloggure | There is no place like ::1"
    />

    <link
      rel="canonical"
      href="http://www.bloggure.info/rescue-a-vps-with-chroot"
    />
    <link
      href="http://www.bloggure.info/feed.xml"
      type="application/atom+xml"
      rel="alternate"
      title="Bloggure | There is no place like ::1 Feed"
    />

    <!-- http://t.co/dKP3o1e -->
    <meta name="HandheldFriendly" content="True" />
    <meta name="MobileOptimized" content="320" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- For all browsers -->
    <link
      rel="stylesheet"
      href="http://www.bloggure.info/assets/css/main.min.css"
    />
    <!-- Webfonts -->
    <link
      href="http://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic"
      rel="stylesheet"
      type="text/css"
    />

    <meta http-equiv="cleartype" content="on" />

    <!-- Load Modernizr -->
    <script src="http://www.bloggure.info/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

    <!-- Icons -->
    <!-- 16x16 -->
    <link rel="shortcut icon" href="http://www.bloggure.info/favicon.ico" />
    <!-- 32x32 -->
    <!-- <link rel="shortcut icon" href="http://www.bloggure.info/favicon.png"> -->
    <!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
    <link
      rel="apple-touch-icon-precomposed"
      href="http://www.bloggure.info/images/apple-touch-icon-precomposed.png"
    />
    <!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
    <link
      rel="apple-touch-icon-precomposed"
      sizes="72x72"
      href="http://www.bloggure.info/images/apple-touch-icon-72x72-precomposed.png"
    />
    <!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
    <link
      rel="apple-touch-icon-precomposed"
      sizes="114x114"
      href="http://www.bloggure.info/images/apple-touch-icon-114x114-precomposed.png"
    />
    <!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
    <link
      rel="apple-touch-icon-precomposed"
      sizes="144x144"
      href="http://www.bloggure.info/images/apple-touch-icon-144x144-precomposed.png"
    />
  </head>

  <body id="post-index" itemscope itemtype="http://schema.org/WebPage">
    <!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
    <div class="meny">
      <nav
        role="navigation"
        itemscope
        itemtype="http://schema.org/SiteNavigationElement"
      >
        <ul>
          <li><a href="/">Home</a></li>
          <li><a href="/archive/">All Posts</a></li>
          <li><a href="/tags/">All Tags</a></li>
        </ul>
        <!-- /.dl-menu -->
      </nav>
      <!-- /.dl-menuwrapper -->
    </div>
    <!--<div class="meny-arrow"></div>-->

    <div class="content">
      <header class="header-title">
        <div class="header-title-wrap">
          <h1 class="entry-title" itemprop="name">
            <a href="http://www.bloggure.info/">Bloggure</a>
          </h1>
        </div>
        <!-- /.header-title-wrap -->
      </header>
      <div
        id="main"
        role="main"
        itemprop="mainContentOfPage"
        itemscope
        itemtype="http://schema.org/Blog"
      >
        <article
          class="hentry"
          itemprop="blogPost"
          itemscope
          itemtype="http://schema.org/BlogPosting"
        >
          <header>
            <div class="entry-meta">
              <span class="entry-date date published updated"
                ><time
                  datetime="2014-09-22T00:00:00+02:00"
                  itemprop="datePublished"
                  ><a href="http://www.bloggure.info/rescue-a-vps-with-chroot"
                    >September 22, 2014</a
                  ></time
                ></span
              ><span
                class="author vcard"
                itemprop="author"
                itemscope
                itemtype="http://schema.org/Person"
                ><span itemprop="name" class="fn"
                  ><a
                    href="http://www.bloggure.info/cgatay"
                    title="About cgatay"
                    itemprop="url"
                    >cgatay</a
                  ></span
                ></span
              >&nbsp; &bull; &nbsp;<span class="entry-comments"
                ><a
                  href="http://www.bloggure.info/rescue-a-vps-with-chroot/#disqus_thread"
                  >Comment</a
                ></span
              >
            </div>
            <!-- /.entry-meta -->

            <h1 class="entry-title" itemprop="name">
              <a
                href="http://www.bloggure.info/rescue-a-vps-with-chroot"
                rel="bookmark"
                title="Rescue a VPS upgrade with chroot"
                itemprop="url"
                >Rescue a VPS upgrade with chroot</a
              >
            </h1>
          </header>
          <div class="entry-content" itemprop="description">
            <h1 id="oops">Oops</h1>
            <p>
              A few days ago, I finally decided to upgrade the installed Linux
              on my dedicated box hosted at
              <a href="http://www.kimsufi.com">OVH</a>. As with every task you
              tend to postpone until it is too late, it failed miserably,
              Murphy’s law I am looking at you right now !
            </p>

            <p>
              During the install process, the machine hanged (I am not sure
              whether the machine is faulty or not, it seems to shut down under
              heavy load). Fortunately for me, OVH is kind enough to send a tech
              resets the machine, and if it does not ping when booted, the tech
              reboots the machine in rescue mode.
            </p>

            <h1 id="rescue-mode">Rescue mode</h1>
            <p>
              The rescue mode is a lightweight Linux booted on the machine so
              you can run <code>fsck</code>and other commands to rescue your
              filesystem (you can even <code>scp</code> files to backup before a
              reinstall for example.
            </p>

            <p>
              My problem was simple, I needed to allow <code>dpkg</code> to
              finish its job in order for me to get a working machine. Then I
              think of the good old powerful <code>chroot</code> command and I
              remembered how powerful Unixes are !
            </p>

            <h1 id="mounting-filesystems">Mounting filesystems</h1>
            <p>
              As you should know, <code>chroot</code> is a command allowing to
              change the root of a file system, litterally jailing it into a
              directory (popular things of today like pico containers like
              Docker are improved versions of chroot).
            </p>

            <p>The partition layout of my machine is the following :</p>

            <ul>
              <li>sda1 contains the root filesystem</li>
              <li>sda2 contains home directories</li>
            </ul>

            <p>
              I issued the following commands to “jail” the rescue mode into my
              machine :
            </p>

            <figure class="highlight">
              <pre><code class="language-bash" data-lang="bash"><span></span>$ mount /dev/sda1 /mnt
$ mount /dev/sda2 /mnt/home
    
$ mount -o <span class="nb">bind</span> /proc /mnt/proc
$ mount -o <span class="nb">bind</span> /dev /mnt/dev
$ mount -o <span class="nb">bind</span> /dev/pts /mnt/dev/pts
$ mount -o <span class="nb">bind</span> /sys /mnt/sys 
$ chroot /mnt/
    </code></pre>
            </figure>

            <p>
              From then, I was on my machine, with my files and so on, so I have
              been able to run <code>dpkg</code> to finish the install :
            </p>

            <figure class="highlight">
              <pre><code class="language-bash" data-lang="bash"><span></span>$ dpkg --configure --a
    </code></pre>
            </figure>

            <p>
              Finally, <code>dpkg</code> sent me back to a working prompt and I
              have been able to reboot the machine (do not forget to change boot
              disk in OVH manager to <code>hd</code> or <code>netboot</code> to
              prevent rebooting in rescue mode).
            </p>

            <footer class="entry-meta">
              <span class="entry-tags"
                ><a
                  href="http://www.bloggure.info/tags/index.html#debian"
                  title="Pages tagged debian"
                  rel="tag"
                  class="tag"
                  >debian</a
                ><a
                  href="http://www.bloggure.info/tags/index.html#vps"
                  title="Pages tagged vps"
                  rel="tag"
                  class="tag"
                  >vps</a
                ><a
                  href="http://www.bloggure.info/tags/index.html#upgrade"
                  title="Pages tagged upgrade"
                  rel="tag"
                  class="tag"
                  >upgrade</a
                ><a
                  href="http://www.bloggure.info/tags/index.html#chroot"
                  title="Pages tagged chroot"
                  rel="tag"
                  class="tag"
                  >chroot</a
                ></span
              >
              <span
                ><a
                  href="http://www.bloggure.info/rescue-a-vps-with-chroot"
                  rel="bookmark"
                  title="Rescue a VPS upgrade with chroot"
                  itemprop="url"
                  >Rescue a VPS upgrade with chroot</a
                ></span
              >
              was published on
              <span class="entry-date date published updated"
                ><time
                  datetime="2014-09-22T00:00:00+02:00"
                  itemprop="datePublished"
                  >September 22, 2014</time
                ></span
              >

              <span
                class="author vcard"
                itemprop="author"
                itemscope
                itemtype="http://schema.org/Person"
                ><span itemprop="name" class="fn"
                  ><a
                    href="http://www.bloggure.info/cgatay"
                    title="About cgatay"
                    itemprop="url"
                    >cgatay</a
                  ></span
                ></span
              >
              <div class="social-share">
                <ul
                  class="socialcount socialcount-small inline-list"
                  data-url="http://www.bloggure.info/rescue-a-vps-with-chroot"
                  data-share-text="Rescue a VPS upgrade with chroot"
                >
                  <li class="facebook">
                    <a
                      href="https://www.facebook.com/sharer/sharer.php?u=http://www.bloggure.info/rescue-a-vps-with-chroot"
                      title="Share on Facebook"
                      ><span class="count"
                        ><i class="icon-facebook-sign"></i> Like</span
                      ></a
                    >
                  </li>
                  <li class="twitter">
                    <a
                      href="https://twitter.com/intent/tweet?text=http://www.bloggure.info/rescue-a-vps-with-chroot"
                      title="Share on Twitter"
                      ><span class="count"
                        ><i class="icon-twitter-sign"></i> Tweet</span
                      ></a
                    >
                  </li>
                  <li class="googleplus">
                    <a
                      href="https://plus.google.com/share?url=http://www.bloggure.info/rescue-a-vps-with-chroot"
                      title="Share on Google Plus"
                      ><span class="count"
                        ><i class="icon-google-plus-sign"></i> +1</span
                      ></a
                    >
                  </li>
                </ul>
              </div>
              <!-- /.social-share -->
            </footer>
          </div>
          <!-- /.entry-content -->
          <section id="disqus_thread"></section>
          <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = "thereisnoplacelike1"; // required: replace example with your forum shortname

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
              var dsq = document.createElement("script");
              dsq.type = "text/javascript";
              dsq.async = true;
              dsq.src = "//" + disqus_shortname + ".disqus.com/embed.js";
              (
                document.getElementsByTagName("head")[0] ||
                document.getElementsByTagName("body")[0]
              ).appendChild(dsq);
            })();

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
              var s = document.createElement("script");
              s.async = true;
              s.type = "text/javascript";
              s.src = "//" + disqus_shortname + ".disqus.com/count.js";
              (
                document.getElementsByTagName("HEAD")[0] ||
                document.getElementsByTagName("BODY")[0]
              ).appendChild(s);
            })();
          </script>
          <noscript
            >Please enable JavaScript to view the
            <a href="http://disqus.com/?ref_noscript"
              >comments powered by Disqus.</a
            ></noscript
          >
          <a href="http://disqus.com" class="dsq-brlink"
            >comments powered by <span class="logo-disqus">Disqus</span></a
          ><!-- /#disqus_thread -->
        </article>
      </div>
      <!-- /#main -->

      <div class="read-more">
        <div class="read-more-header">
          <a
            href="http://www.bloggure.info/brew-cask-install-everything-from-cli"
            class="read-more-btn"
            >Read More</a
          >
        </div>
        <!-- /.read-more-header -->
        <div class="read-more-content">
          <h3>
            <a href="http://www.bloggure.info/Revival" title="Bloggure revival"
              >Bloggure revival</a
            >
          </h3>
          <p>
            # It's been a long timeIt's been a very long time since last post (5
            years...).I am convinced that blogging is useful, at least for my
            pr...&hellip;
            <a href="http://www.bloggure.info/Revival">Continue reading</a>
          </p>
        </div>
        <!-- /.read-more-content -->

        <div class="read-more-list">
          <div class="list-item">
            <h4>
              <a
                href="http://www.bloggure.info/redsocks-avoid-docker-proxy-headaches"
                title="Avoid Proxy Headaches in Docker with redsocks"
                >Avoid Proxy Headaches in Docker with redsocks</a
              >
            </h4>
            <span>Published on November 16, 2015</span>
          </div>
          <!-- /.list-item -->

          <div class="list-item">
            <h4>
              <a
                href="http://www.bloggure.info/faster-ssh-multi-hop"
                title="Faster ssh multi hop"
                >Faster ssh multi hop</a
              >
            </h4>
            <span>Published on September 07, 2015</span>
          </div>
          <!-- /.list-item -->
        </div>
        <!-- /.read-more-list -->
      </div>
      <!-- /.read-more -->

      <div class="footer-wrapper">
        <footer role="contentinfo">
          <span
            >&copy; 2020 . Powered by
            <a href="http://jekyllrb.com">Jekyll</a> using a theme based on
            <a href="http://mademistakes.com/">HPSTR</a>.</span
          >
        </footer>
      </div>
      <!-- /.footer-wrapper -->
    </div>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script>
      window.jQuery ||
        document.write(
          '<script src="http://www.bloggure.info/assets/js/vendor/jquery-1.9.1.min.js"><\/script>'
        );
    </script>
    <script src="http://www.bloggure.info/assets/js/scripts.min.js"></script>

    <!-- Asynchronous Google Analytics snippet -->
    <script>
      var _gaq = _gaq || [];
      var pluginUrl = "//www.google-analytics.com/plugins/ga/inpage_linkid.js";
      _gaq.push(["_require", "inpage_linkid", pluginUrl]);
      _gaq.push(["_setAccount", "UA-11718843-3"]);
      _gaq.push(["_trackPageview"]);

      (function () {
        var ga = document.createElement("script");
        ga.type = "text/javascript";
        ga.async = true;
        ga.src =
          ("https:" == document.location.protocol
            ? "https://ssl"
            : "http://www") + ".google-analytics.com/ga.js";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </body>
</html>
