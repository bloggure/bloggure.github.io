<!DOCTYPE html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en">
  <!--<![endif]-->
  <head>
    <meta charset="utf-8" />
    <title>
      mongoDB request failing when upgrading (1.8 > 2.x) &#8211; Bloggure
    </title>
    <meta
      name="description"
      content="Multi author blog about programming, computing and geek stuff"
    />
    <meta name="keywords" content="error, mongodb, nosql, upgrade" />

    <!-- Open Graph -->
    <meta property="og:locale" content="en_US" />
    <meta property="og:type" content="article" />
    <meta
      property="og:title"
      content="mongoDB request failing when upgrading (1.8 > 2.x)"
    />
    <meta
      property="og:description"
      content="Multi author blog about programming, computing and geek stuff"
    />
    <meta
      property="og:url"
      content="http://www.bloggure.info/nosql/work/mongodb-request-failing-when-upgrading-1-8-2-x"
    />
    <meta property="og:site_name" content="Bloggure" />

    <link
      rel="canonical"
      href="http://www.bloggure.info/nosql/work/mongodb-request-failing-when-upgrading-1-8-2-x"
    />
    <link
      href="http://www.bloggure.info/feed.xml"
      type="application/atom+xml"
      rel="alternate"
      title="Bloggure Feed"
    />

    <!-- http://t.co/dKP3o1e -->
    <meta name="HandheldFriendly" content="True" />
    <meta name="MobileOptimized" content="320" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- For all browsers -->
    <link
      rel="stylesheet"
      href="http://www.bloggure.info/assets/css/main.css"
    />
    <!-- Webfonts -->
    <link
      href="https://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic"
      rel="stylesheet"
      type="text/css"
    />

    <meta http-equiv="cleartype" content="on" />

    <!-- Load Modernizr -->
    <script src="http://www.bloggure.info/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

    <!-- Icons -->
    <!-- 16x16 -->
    <link rel="shortcut icon" href="http://www.bloggure.info/favicon.ico" />
    <!-- 32x32 -->
    <link rel="shortcut icon" href="http://www.bloggure.info/favicon.png" />
    <!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
    <link
      rel="apple-touch-icon-precomposed"
      href="http://www.bloggure.info/images/apple-touch-icon-precomposed.png"
    />
    <!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
    <link
      rel="apple-touch-icon-precomposed"
      sizes="72x72"
      href="http://www.bloggure.info/images/apple-touch-icon-72x72-precomposed.png"
    />
    <!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
    <link
      rel="apple-touch-icon-precomposed"
      sizes="114x114"
      href="http://www.bloggure.info/images/apple-touch-icon-114x114-precomposed.png"
    />
    <!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
    <link
      rel="apple-touch-icon-precomposed"
      sizes="144x144"
      href="http://www.bloggure.info/images/apple-touch-icon-144x144-precomposed.png"
    />
  </head>

  <body id="post">
    <!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->

    <div class="entry-header">
      <header class="header-title">
        <div class="header-title-wrap">
          <h1 class="entry-title" itemprop="name">
            <a href="http://www.bloggure.info/">Bloggure</a>
          </h1>
        </div>
        <!-- /.header-title-wrap -->
      </header>
    </div>

    <div id="main" role="main">
      <article class="hentry">
        <div class="entry-content">
          <header>
            <div class="entry-meta">
              <span class="entry-date date published updated"
                ><time
                  datetime="2012-02-12T00:00:00+01:00"
                  itemprop="datePublished"
                  ><a
                    href="http://www.bloggure.info/nosql/work/mongodb-request-failing-when-upgrading-1-8-2-x"
                    >February 12, 2012</a
                  ></time
                ></span
              ><span
                class="author vcard"
                itemprop="author"
                itemscope
                itemtype="http://schema.org/Person"
                ><span itemprop="name" class="fn"
                  ><a
                    href="http://www.bloggure.info/cgatay"
                    title="About cgatay"
                    itemprop="url"
                    >cgatay</a
                  ></span
                ></span
              >&nbsp; &bull; &nbsp;<span class="entry-comments"
                ><a
                  href="http://www.bloggure.info/nosql/work/mongodb-request-failing-when-upgrading-1-8-2-x#disqus_thread"
                  >Comment</a
                ></span
              >
            </div>
            <!-- /.entry-meta -->

            <h1 class="entry-title" itemprop="name">
              <a
                href="http://www.bloggure.info/nosql/work/mongodb-request-failing-when-upgrading-1-8-2-x"
                rel="bookmark"
                title="mongoDB request failing when upgrading (1.8 > 2.x)"
                itemprop="url"
                >mongoDB request failing when upgrading (1.8 > 2.x)</a
              >
            </h1>
          </header>
          <!--:en-->
          <p>
            At work we faced a strange issue with mongoDB 2.x. Whereas our
            requests were working perfectly with mongoDB 1.8 we always got
            errors. The message mongoDB was firing at us was of the form :
          </p>

          <figure class="highlight">
            <pre><code class="language-java" data-lang="java"><span></span><span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span><span class="w"> </span><span class="n">com</span><span class="p">.</span><span class="na">mongodb</span><span class="p">.</span><span class="na">MongoException</span><span class="p">:</span><span class="w"> </span><span class="n">assertion</span><span class="w"> </span><span class="n">db</span><span class="o">/</span><span class="p">..</span><span class="o">/</span><span class="n">bson</span><span class="o">/</span><span class="n">bsonobjbuilder</span><span class="p">.</span><span class="na">h</span><span class="p">:</span><span class="mi">127</span>
<span class="w">       </span><span class="n">at</span><span class="w"> </span><span class="n">com</span><span class="p">.</span><span class="na">mongodb</span><span class="p">.</span><span class="na">MongoException</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="n">MongoException</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">82</span><span class="p">)</span></code></pre>
          </figure>
          <img
            src="/images/uploads/2012/02/mongo.png"
            alt=""
            title="mongoDB leaf"
            width="128"
            height="128"
            class="alignright size-full wp-image-507"
          />
          <p>
            I found the following issue in
            <a href="https://jira.mongodb.org/browse/SERVER-3846"
              >mongoDB's Jira</a
            >
            but apparently nothing to do with our requests (we are not using
            empty properties indexes), it takes me a lot of time to figure out
            that, at times, our request were sorted on empty properties (<a
              href="https://jira.mongodb.org/browse/SERVER-3874"
              >as stated here</a
            >). The fix is really simple,
            <strong>do not sort on empty properties</strong> !
          </p>

          <p>
            As it takes me times to find this and I did not find any blog post
            explaining this, I hope it will help another developer.
          </p>
          <!--:--><!--:frNous avons rencontré un problème assez étrange avec mongoDB 2.x. Alors que nos requêtes existantes marchaient sans aucun soucis avec mongoDB 1.8. mongoDB répondait invariablement avec l'erreur suivante :

<pre class="brush: java">
Caused by: com.mongodb.MongoException: assertion db/../bson/bsonobjbuilder.h:127
       at com.mongodb.MongoException.parse(MongoException.java:82)
</pre>
<img src="/images/uploads/2012/02/mongo.png" alt="" title="mongoDB leaf" width="128" height="128" class="alignright size-full wp-image-507" />
J'ai bien sur trouvé le bug suivant sur <a href="https://jira.mongodb.org/browse/SERVER-3846">le Jira du projet mongoDB</a> mais apparement rien à voir avec nos requêtes (nous n'avons pas d'index sur des propriétés vides). Cela m'a pris pas mal de temps avant de comprendre que, parfois, nos requêtes étaient parfois triées sur des propriétés vides (<a href="https://jira.mongodb.org/browse/SERVER-3874">comme précisé ici</a>).
Le correctif est vraiment simple, <strong>ne triez pas sur des propriétés vides</strong> !

Puisque j'ai mis pas mal de temps à comprendre ce qui se passait et que je n'ai trouvé aucun billet relatif, j'espère que ça aidera un autre développeur.<-->

          <footer class="entry-meta">
            <span class="entry-tags"
              ><a
                href="http://www.bloggure.info/tags/#error"
                title="Pages tagged error"
                class="tag"
                ><span class="term">error</span></a
              ><a
                href="http://www.bloggure.info/tags/#mongodb"
                title="Pages tagged mongodb"
                class="tag"
                ><span class="term">mongodb</span></a
              ><a
                href="http://www.bloggure.info/tags/#nosql"
                title="Pages tagged nosql"
                class="tag"
                ><span class="term">nosql</span></a
              ><a
                href="http://www.bloggure.info/tags/#upgrade"
                title="Pages tagged upgrade"
                class="tag"
                ><span class="term">upgrade</span></a
              ></span
            >

            <div class="social-share">
              <ul class="socialcount socialcount-small inline-list">
                <li class="facebook">
                  <a
                    href="https://www.facebook.com/sharer/sharer.php?u=http://www.bloggure.info/nosql/work/mongodb-request-failing-when-upgrading-1-8-2-x"
                    title="Share on Facebook"
                    ><span class="count"
                      ><i class="fa fa-facebook-square"></i> Like</span
                    ></a
                  >
                </li>
                <li class="twitter">
                  <a
                    href="https://twitter.com/intent/tweet?text=http://www.bloggure.info/nosql/work/mongodb-request-failing-when-upgrading-1-8-2-x"
                    title="Share on Twitter"
                    ><span class="count"
                      ><i class="fa fa-twitter-square"></i> Tweet</span
                    ></a
                  >
                </li>
              </ul>
            </div>
            <!-- /.social-share -->
          </footer>
        </div>
        <!-- /.entry-content -->
        <section id="disqus_thread"></section>
        <!-- /#disqus_thread -->
        <div class="read-more">
          <div class="read-more-header">
            <a
              href="http://www.bloggure.info/.git/.maven/git-bisect-saved-my-day"
              class="read-more-btn"
              >Read More</a
            >
          </div>
          <!-- /.read-more-header -->
          <div class="read-more-content">
            <h3>
              <a
                href="http://www.bloggure.info/Tuist_build_test_schemes"
                title="Tuist build test schemes"
                >Tuist build test schemes</a
              >
            </h3>
            <p>
              Tuist build test schemesI use tuist to build most of my iOS
              projects nowadays. And like every good software engineer I test
              the code that...&hellip;
              <a href="http://www.bloggure.info/Tuist_build_test_schemes"
                >Continue reading</a
              >
            </p>
          </div>
          <!-- /.read-more-content -->

          <div class="read-more-list">
            <div class="list-item">
              <h4>
                <a
                  href="http://www.bloggure.info/Module_Registration_Swift"
                  title="Swift module registration"
                  >Swift module registration</a
                >
              </h4>
              <span>Published on April 28, 2025</span>
            </div>
            <!-- /.list-item -->

            <div class="list-item">
              <h4>
                <a
                  href="http://www.bloggure.info/Swift_VisibleForTesting_Macro"
                  title="Swift macro : @VisibleForTesting"
                  >Swift macro : @VisibleForTesting</a
                >
              </h4>
              <span>Published on April 19, 2024</span>
            </div>
            <!-- /.list-item -->
          </div>
          <!-- /.read-more-list -->
        </div>
        <!-- /.read-more -->
      </article>
    </div>
    <!-- /#main -->

    <div class="footer-wrapper">
      <footer role="contentinfo">
        <span
          >&copy; 2025 . Powered by
          <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using a theme
          based on
          <a
            href="https://mademistakes.com/work/hpstr-jekyll-theme/"
            rel="nofollow"
            >HPSTR</a
          >.</span
        >
      </footer>
    </div>
    <!-- /.footer-wrapper -->

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script>
      window.jQuery ||
        document.write(
          '<script src="http://www.bloggure.info/assets/js/vendor/jquery-1.9.1.min.js"><\/script>'
        );
    </script>
    <script src="http://www.bloggure.info/assets/js/scripts.min.js"></script>

    <!-- Asynchronous Google Analytics snippet -->
    <script>
      (function (i, s, o, g, r, a, m) {
        i["GoogleAnalyticsObject"] = r;
        (i[r] =
          i[r] ||
          function () {
            (i[r].q = i[r].q || []).push(arguments);
          }),
          (i[r].l = 1 * new Date());
        (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m);
      })(
        window,
        document,
        "script",
        "//www.google-analytics.com/analytics.js",
        "ga"
      );

      ga("create", "UA-11718843-3", "auto");
      ga("require", "linkid", "linkid.js");
      ga("send", "pageview");
    </script>

    <script type="text/javascript">
      /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
      var disqus_shortname = "thereisnoplacelike1"; // required: replace example with your forum shortname

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function () {
        var dsq = document.createElement("script");
        dsq.type = "text/javascript";
        dsq.async = true;
        dsq.src = "//" + disqus_shortname + ".disqus.com/embed.js";
        (
          document.getElementsByTagName("head")[0] ||
          document.getElementsByTagName("body")[0]
        ).appendChild(dsq);
      })();

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function () {
        var s = document.createElement("script");
        s.async = true;
        s.type = "text/javascript";
        s.src = "//" + disqus_shortname + ".disqus.com/count.js";
        (
          document.getElementsByTagName("HEAD")[0] ||
          document.getElementsByTagName("BODY")[0]
        ).appendChild(s);
      })();
    </script>
    <noscript
      >Please enable JavaScript to view the
      <a href="http://disqus.com/?ref_noscript"
        >comments powered by Disqus.</a
      ></noscript
    >
    <a href="http://disqus.com" class="dsq-brlink"
      >comments powered by <span class="logo-disqus">Disqus</span></a
    >
  </body>
</html>
