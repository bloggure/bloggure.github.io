<script>
  (function() {
    function loadScript(src) {
      return new Promise(function(resolve, reject) {
        var script = document.createElement('script');
        script.src = src;
        script.defer = true;
        script.async = false;
        script.onload = resolve;
        script.onerror = reject;
        document.head.appendChild(script);
      });
    }

    var jqCdn = '//ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js';
    var jqLocal = '{{ site.url }}/assets/js/vendor/jquery-3.7.1.min.js';
    var needFitVids = document.querySelector('article iframe, article video');
    var needMagnific = document.querySelector(
      'a[href$=".jpg" i],a[href$=".jpeg" i],a[href$=".png" i],a[href$=".gif" i]'
    );

    var jqPromise = loadScript(jqCdn)
      .catch(function() {
        return loadScript(jqLocal);
      })
      .then(function() {
        if (!window.jQuery) {
          return loadScript(jqLocal);
        }
      });

    jqPromise
      .then(function() {
        var chain = Promise.resolve();
        {% if page.layout == 'post' %}
        if (needFitVids) {
          chain = chain.then(function() {
            return loadScript('{{ site.url }}/assets/js/plugins/jquery.fitvids.js');
          });
        }
        if (needMagnific) {
          chain = chain.then(function() {
            return loadScript('{{ site.url }}/assets/js/plugins/jquery.magnific-popup.js');
          });
        }
        {% endif %}
        return chain;
      })
      .then(function() {
        return loadScript('{{ site.url }}/assets/js/scripts.min.js');
      });
  })();
</script>

{% if site.google_analytics %}
<!-- Asynchronous Google Analytics snippet -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', '{{ site.google_analytics }}', 'auto');  
  ga('require', 'linkid', 'linkid.js');
  ga('send', 'pageview');
</script>
{% endif %}

{% if page.comments != false %}{% include disqus_comments.html %}{% endif %}
