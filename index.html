<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Bloggure</title>
<meta name="description" content="Multi author blog about programming, computing and geek stuff">




<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Bloggure">
<meta property="og:description" content="Multi author blog about programming, computing and geek stuff">
<meta property="og:url" content="http://www.bloggure.info/">
<meta property="og:site_name" content="Bloggure">





<link rel="canonical" href="http://www.bloggure.info/">
<link href="http://www.bloggure.info/feed.xml" type="application/atom+xml" rel="alternate" title="Bloggure Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="http://www.bloggure.info/assets/css/main.css">
<!-- Webfonts -->
<link href="https://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">

<meta http-equiv="cleartype" content="on">

<script>
  document.documentElement.className =
    document.documentElement.className.replace(/\bno-js\b/, 'js');
</script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://www.bloggure.info/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://www.bloggure.info/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://www.bloggure.info/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://www.bloggure.info/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://www.bloggure.info/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://www.bloggure.info/images/apple-touch-icon-144x144-precomposed.png">



</head>

<body id="post-index" >

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->

<div class="entry-header">
  
  
  <div class="header-title">
    <div class="header-title-wrap">
      <h1 itemprop="name"><a href="http://www.bloggure.info/">Bloggure</a></h1>
      <h2><a href="/"></a></h2>
    </div><!-- /.header-title-wrap -->
  </div><!-- /.header-title -->
</div><!-- /.entry-header -->

<div id="main" role="main">
  

<article class="hentry" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    <div class="entry-meta"><span class="entry-date date published updated"><time datetime="2026-01-07T00:00:00+01:00" itemprop="datePublished"><a href="http://www.bloggure.info/Shortcut_bill_renaming">January 07, 2026</a></time></span><span class="author vcard" itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name" class="fn"><a href="http://www.bloggure.info/cgatay" title="About cgatay" itemprop="url">cgatay</a></span></span>&nbsp; &bull; &nbsp;<span class="entry-comments"><a href="http://www.bloggure.info/Shortcut_bill_renaming#disqus_thread">Comment</a></span></div><!-- /.entry-meta -->
    
      <h1 class="entry-title" itemprop="name"><a href="http://www.bloggure.info/Shortcut_bill_renaming" rel="bookmark" title="Streamlining Finances: Automating Bill Renaming with Apple Shortcuts" itemprop="url">Streamlining Finances: Automating Bill Renaming with Apple Shortcuts</a></h1>
    
  </header>
  <div class="entry-content" itemprop="description">
    <h2 id="the-problem-the-downloads-folder-chaos">The Problem: The ‚ÄúDownloads‚Äù Folder Chaos</h2>

<p>We all know the struggle. You download a PDF invoice from your utility provider or internet service, and the file is named something useless like <code>invoice_839204_export.pdf</code>. These cryptic filenames make it nearly impossible to find specific bills later, clutter your file system, and create frustration when you‚Äôre trying to organize your finances.</p>

<p>The goal is simple: automatically rename these files to a standard, searchable format like <code>YYYY-MM-DD_Company.pdf</code> so you can easily find, sort, and manage your financial documents.</p>

<p><strong>Common pain points:</strong></p>
<ul>
  <li>Difficulty finding specific bills when you need them</li>
  <li>Messy file organization that grows over time</li>
  <li>Time wasted manually renaming files</li>
  <li>Inconsistent naming conventions across different providers</li>
</ul>

<h2 id="the-solution-apple-shortcuts">The Solution: Apple Shortcuts</h2>

<p>I chose Apple Shortcuts for this automation because it‚Äôs native to both macOS and iOS, completely free, and syncs seamlessly across all your Apple devices. Unlike complex Python scripts or third-party automation tools, Shortcuts provides a visual, user-friendly interface that makes it accessible to everyone - not just developers.</p>

<p>The best part? You can trigger these automations from the Share Sheet, Quick Actions, or even set up folder-based automation, making it incredibly convenient for daily use.</p>

<h2 id="how-the-shortcut-works">How the Shortcut Works</h2>

<p>Before you download the shortcut, here is the logic behind the workflow. Breaking it down helps if you want to customize it later.</p>

<ol>
  <li><strong>Input:</strong> The shortcut accepts a PDF or an image file (via the Share Sheet or Quick Actions).</li>
  <li><strong>Text Extraction:</strong> It extracts the text from the image, and asks ChatGPT or other AI models to extract vendor and date from the document</li>
  <li><strong>Formatting:</strong> It standardizes the date to ISO format (<code>YYYY-MM-DD</code>).</li>
  <li><strong>Renaming:</strong> It combines the variables into a new filename string.</li>
  <li><strong>Saving:</strong> It changes the file name in-place with the new one</li>
</ol>

<h3 id="the-logic-breakdown">The Logic Breakdown</h3>

<p>The shortcut uses a combination of Apple‚Äôs built-in actions and AI-powered text extraction:</p>

<ul>
  <li><strong>Text Extraction:</strong> Uses OCR (Optical Character Recognition) to read text from PDFs and images</li>
  <li><strong>AI Processing:</strong> Leverages ChatGPT to intelligently identify vendor names and dates</li>
  <li><strong>Date Standardization:</strong> Converts various date formats to consistent ISO format</li>
  <li><strong>Batch Processing:</strong> Can handle multiple files at once for efficiency</li>
</ul>

<blockquote>
  <p><strong>Pro Tip:</strong> The AI component makes this shortcut smarter than traditional regex-based solutions. It can handle different invoice formats and layouts automatically.</p>
</blockquote>

<h2 id="get-the-shortcut">Get the Shortcut</h2>

<p>You can download the shortcut directly to your library using the link below:</p>

<p><strong><a href="https://www.icloud.com/shortcuts/df9854a70cc34f9285f21b805518cd79"> üì• Download: Rename Bills Shortcut</a></strong></p>

<p><em>(Note: You might need to allow untrusted shortcuts in settings if you haven‚Äôt already, though Apple has changed how this works in recent iOS versions.)</em></p>

<p><strong>Requirements:</strong></p>
<ul>
  <li>iOS 16+ or macOS Ventura+</li>
  <li>Apple Shortcuts app installed</li>
  <li>Internet connection for AI processing (or local/offline alternative)</li>
  <li>ChatGPT API key (free tier available)</li>
</ul>

<p><strong>Privacy Note:</strong> If you‚Äôre concerned about privacy or prefer offline processing, you can modify this shortcut to use local model or private cloud models instead of ChatGPT. The shortcut can be adapted to use either approach based on your preferences.</p>

<h2 id="how-to-set-it-up">How to Set It Up</h2>

<p>Once you have installed the shortcut, you need to configure a few variables to match your preferences:</p>

<ol>
  <li><strong>ChatGPT API Key:</strong> Add your ChatGPT API key in the shortcut settings for AI processing</li>
  <li><strong>Naming Convention:</strong> If you prefer <code>Company_Date</code> instead of <code>Date_Company</code>, you can drag and drop the variables in the ‚ÄúSet Name‚Äù action.</li>
  <li><strong>Date Format:</strong> The shortcut uses ISO format (YYYY-MM-DD) by default, but you can modify the date formatting action if you prefer a different format.</li>
  <li><strong>File Types:</strong> By default, it handles PDFs and images (PNG, JPG). You can add more file types in the input action.</li>
</ol>

<p><img src="/images/post/shortcut-editor.png" alt="Apple Shortcuts Editor showing the Rename Bills workflow with actions for getting text from PDF, formatting date, and saving file" /></p>

<p><strong>Configuration Tips:</strong></p>
<ul>
  <li>Test with a few sample files first</li>
  <li>Adjust the AI prompt if you need different extraction behavior</li>
  <li>Consider adding error handling for edge cases</li>
</ul>

<h2 id="usage-guide">Usage Guide</h2>

<p>Here is how to use it in daily life:</p>

<h3 id="on-macos">On macOS</h3>
<ol>
  <li>Right-click a PDF or image file -&gt; <strong>Quick Actions</strong> -&gt; Select <strong>Auto rename Bill</strong></li>
  <li>For batch processing: Select multiple files -&gt; Right-click -&gt; <strong>Quick Actions</strong> -&gt; <strong>Auto rename Bill</strong></li>
</ol>

<h3 id="on-ios--ipados">On iOS / iPadOS</h3>
<ol>
  <li>Open the PDF or image -&gt; Tap the <strong>Share</strong> icon -&gt; Scroll down and tap <strong>Auto rename Bill</strong></li>
  <li>For batch processing: Select multiple files in Files app -&gt; Tap Share -&gt; <strong>Auto rename Bill</strong></li>
</ol>

<h3 id="advanced-usage">Advanced Usage</h3>
<ul>
  <li><strong>Folder Automation:</strong> Set up a folder action in macOS to automatically process new files added to a specific folder</li>
  <li><strong>Siri Integration:</strong> Add the shortcut to Siri for voice-activated renaming</li>
  <li><strong>Batch Processing:</strong> Process multiple files at once to save time</li>
</ul>

<p><strong>Pro Tip:</strong> Create a dedicated ‚ÄúBills to Process‚Äù folder and set up a folder action to automatically rename files when they‚Äôre added.</p>

<h2 id="conclusion">Conclusion</h2>

<p>Automation doesn‚Äôt have to be complicated code. With Apple Shortcuts, you can save yourself the 30 seconds it takes to rename a file‚Äîwhich adds up over a lifetime of paying bills.</p>

<p><strong>Time Savings Calculation:</strong></p>
<ul>
  <li>30 seconds per bill √ó 12 bills/month √ó 12 months/year = 6 minutes/year</li>
  <li>Over 10 years = 1 hour saved</li>
  <li>Over a lifetime = Significant time savings!</li>
</ul>

<p>This shortcut demonstrates how AI-powered automation can make everyday tasks easier. The combination of OCR, AI text extraction, and Apple‚Äôs automation framework creates a powerful tool that‚Äôs accessible to everyone.</p>

  </div><!-- /.entry-content -->
</article><!-- /.hentry -->



<article class="hentry" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    <div class="entry-meta"><span class="entry-date date published updated"><time datetime="2025-05-22T00:00:00+02:00" itemprop="datePublished"><a href="http://www.bloggure.info/Tuist_build_test_schemes">May 22, 2025</a></time></span><span class="author vcard" itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name" class="fn"><a href="http://www.bloggure.info/cgatay" title="About cgatay" itemprop="url">cgatay</a></span></span>&nbsp; &bull; &nbsp;<span class="entry-comments"><a href="http://www.bloggure.info/Tuist_build_test_schemes#disqus_thread">Comment</a></span></div><!-- /.entry-meta -->
    
      <h1 class="entry-title" itemprop="name"><a href="http://www.bloggure.info/Tuist_build_test_schemes" rel="bookmark" title="Tuist build test schemes" itemprop="url">Tuist build test schemes</a></h1>
    
  </header>
  <div class="entry-content" itemprop="description">
    <p>Tuist build test schemes</p>

<p>I use tuist to build most of my iOS projects nowadays. And like every good software engineer I test the code that I deliver. I want to ensure that everything works according to what I expect is coming to my app.</p>

<h3 id="xcode-and-schemes">Xcode and schemes</h3>

<p>XCode is a fun IDE, it is slow, has his own temper when it comes to find references, refactor or even launch app.
One of the things that is really strange when you‚Äôre using this IDE for the first time is that it does only build the active scheme.
So, if your project has, let‚Äôs say, 10 schemes, and you refactor a method to add an argument. You won‚Äôt notice you have a build error until your build all schemes‚Ä¶</p>

<h3 id="build-errors">Build errors</h3>

<p>I tend to have a lot of build errors during refactoring, but this is globally ok, I use them to pave the way to my final implementation.
One of the thing that bothers me is that I don‚Äôt always catch all errors, and I need the CI to bail out because of a missing argument / protocol conformance method‚Ä¶
This is not a cool thing in my daily process, I am interrupted to fix a build error that should never happen.</p>

<h3 id="build-tests-target-automatically">Build tests target automatically</h3>

<p>As I am a tuist user, I want to be able to build all my tests target easily to prevent pushing something that does not even build (even before I can say that my tests are passing).</p>

<h4 id="command-line-fu">Command line-fu</h4>

<p>At first I tried a basic thing, hoping that it would work (spoiler alert, it does not):</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"> tuist build <span class="s1">'*Tests'</span>
 </code></pre></figure>

<h4 id="scripting-to-the-rescue">Scripting to the rescue</h4>

<p>It seems that it is not supported out of the box by tuist, running schemes by using a wildcard operator to filter them. However, it is rather easy to do using basic bash scripting, so here is my basic solution</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">set</span> <span class="nt">-e</span>
<span class="nv">SCHEMES</span><span class="o">=</span><span class="si">$(</span>xcodebuild <span class="nt">-workspace</span> MyProject.xcworkspace <span class="nt">-list</span> | <span class="nb">grep </span>Tests | <span class="nb">awk</span> <span class="s1">'{print $1}'</span><span class="si">)</span>

<span class="nb">echo</span> <span class="s2">"</span><span class="nv">$SCHEMES</span><span class="s2">"</span> | <span class="k">while </span><span class="nv">IFS</span><span class="o">=</span> <span class="nb">read</span> <span class="nt">-r</span> s<span class="p">;</span> <span class="k">do
   </span><span class="nb">echo</span> <span class="s2">"Building </span><span class="nv">$s</span><span class="s2">"</span>
   tuist build <span class="nv">$s</span>
<span class="k">done</span></code></pre></figure>

<p>I save this file under <code>buildTests.sh</code>, run a <code>chmod +x buildTests.sh</code> and then I can build my tests targets, in sequence, exiting on first failure. This is perfect for my use case, whenever I refactor too much, or I want to check that tests are still building, I can run this.</p>

<h3 id="downside">Downside</h3>

<p>Script execution is rather slow, as there is not any parallelism involved, everything is building from scratch.
It might be nice to run everything in parallel, but so far so good, it is ok for my use case !</p>

  </div><!-- /.entry-content -->
</article><!-- /.hentry -->



<article class="hentry" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    <div class="entry-meta"><span class="entry-date date published updated"><time datetime="2025-04-28T00:00:00+02:00" itemprop="datePublished"><a href="http://www.bloggure.info/Module_Registration_Swift">April 28, 2025</a></time></span><span class="author vcard" itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name" class="fn"><a href="http://www.bloggure.info/cgatay" title="About cgatay" itemprop="url">cgatay</a></span></span>&nbsp; &bull; &nbsp;<span class="entry-comments"><a href="http://www.bloggure.info/Module_Registration_Swift#disqus_thread">Comment</a></span></div><!-- /.entry-meta -->
    
      <h1 class="entry-title" itemprop="name"><a href="http://www.bloggure.info/Module_Registration_Swift" rel="bookmark" title="Swift module registration" itemprop="url">Swift module registration</a></h1>
    
  </header>
  <div class="entry-content" itemprop="description">
    <p>Swift module registration</p>

<p>Let‚Äôs modularize our Swift code!</p>

<p>I am using tuist for a while now in my projects. This tool was initially bring into the project‚Äôs scope to ease day to day developer operations : no more fiddling with conflicts in xcodeproject files !</p>

<h3 id="tuist-">Tuist ?</h3>

<p>What is tuist by the way ?</p>

<p>Have you ever booted an iOS project, from a few years things have evolved a bit.</p>

<p>Before 2020 I‚Äôd say we were doomed to using xcworkspace for defining complex projects.</p>

<p>Cocoapod and Carthage were the cool kids on the block, allowing to download libraries and use them in our beautiful apps.</p>

<p>After 2020, and still now, Swift development have changed to massively using SPM: the built in dependency management tool baked in the swift toolchain. The process is straightforward and easy to set up, a few clicks in XCode and voila! The other way of using SPM is by using a Package.swift file to describe what you want to achieve.</p>

<p>The swift file works very well but lacks from a lot of advanced features available in XCode projects. Or if it is possible, it is not convenient to do.</p>

<p>This is where tuist fills the gap, like Gradle in the Java ecosystem did a few years ago. We can finally use Swift to describe our Swift projects. This means no more copasting things over and over and the dreaded xcodeproj is no more : you‚Äôll only ever have to merge swift files !</p>

<h2 id="code-modularity-appears-">Code modularity appears !</h2>

<p>It also came in handy for bringing modularity into our codebase. We managed to split dependencies and make modules per feature or functional scope.</p>

<p>This comes at a cost, having to register our different modules to our main app. When I‚Äôm talking about registering, I‚Äôm¬†considering handling dependencies, routing and navigation. This can represent a lot of modules, a lot of useless lines in our codebase.</p>

<p>To be clearer, our main app contains authentication logic as well as basic http interactions, our modules are dumb as they depend on this external provider to be able to issue any http call.</p>

<h2 id="first-implementation">First implementation</h2>

<p>Every of our module was being added to our ResourceLoader class that would call the necessary initializers to set things in motion like the following</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">func</span> <span class="nf">register</span><span class="p">(){</span>
  <span class="kt">LoggingModule</span><span class="o">.</span><span class="nf">register</span><span class="p">()</span>
  <span class="err">‚Ä¶</span>
<span class="p">}</span></code></pre></figure>

<p>With our ResourceLoader implementing a protocol exposing everything that was useful for our submodules, protocol which was made available through a simple used-everywhere dependency.</p>

<h2 id="auto-registration-for-the-win-">Auto-registration for the win !</h2>

<p>We can do module autoregistration by scanning embedded frameworks. As we can do with IoC, the idea is to let every module declare itself to the main consumer. No more long <code>register</code> method in our application launch, and new modules are automatically discovered at launch time !</p>

<p>Let‚Äôs illustrate this with some code, we declare a protocol that will allow consumer to call registration for our module.</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">public</span> <span class="kd">protocol</span> <span class="kt">ModuleRegistration</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">register</span><span class="p">()</span>
<span class="p">}</span></code></pre></figure>

<p>This is our base building block for registration, every module implements <code>ModuleRegistration</code> to contribute to the main app.</p>

<p>In every module project, we then set a class that will be responsible for registration. It will implement this specific protocol and be populated by its full name into <code>Info.plist</code>.</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">@objc</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="kt">MyFrameworkRegistration</span><span class="p">:</span> <span class="kt">NSObject</span><span class="p">,</span> <span class="kt">ModuleRegistration</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kd">func</span> <span class="nf">register</span><span class="p">()</span> <span class="p">{</span>
      <span class="c1">// inject into the global context our dependencies</span>
      <span class="c1">// for instance we can do</span>
      <span class="c1">// Container.register(MyLogging.self, MyLoggingImpl.self)</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Please notice important things in this class. It needs to be annotated <code>@objc</code>  and inherit from <code>NSObject</code> to be discoverable later on.</p>

<p>The magic being this is that we will declare this class to be our <code>NSPrincipalClass</code>  in the <code>Info.plist</code> of our framework.</p>

<p>To do so, we add the final touch by enriching the <code>Info.plist</code> of our module using Tuist project‚Äôs description :</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="o">.</span><span class="nf">target</span><span class="p">(</span>
        <span class="nv">name</span><span class="p">:</span> <span class="s">"MyFramework"</span><span class="p">,</span>
        <span class="nv">destinations</span><span class="p">:</span> <span class="o">.</span><span class="n">iOS</span><span class="p">,</span>
        <span class="nv">product</span><span class="p">:</span> <span class="o">.</span><span class="n">framework</span><span class="p">,</span>
        <span class="nv">bundleId</span><span class="p">:</span> <span class="s">"org.9h41.ios.modules"</span><span class="p">,</span>
        <span class="nv">deploymentTargets</span><span class="p">:</span> <span class="o">.</span><span class="nf">iOS</span><span class="p">(</span><span class="s">"16.0"</span><span class="p">),</span>
        <span class="nv">infoPlist</span><span class="p">:</span> <span class="o">.</span><span class="nf">extendingDefault</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="p">[</span>
             <span class="s">"NSPrincipalClass"</span><span class="p">:</span> <span class="s">"MyFramework.MyFrameworkRegistration"</span><span class="p">,</span>
        <span class="p">]),</span>
        <span class="nv">sources</span><span class="p">:</span> <span class="o">.</span><span class="nf">paths</span><span class="p">([</span><span class="s">"MyFramework/Sources/**"</span><span class="p">])</span>
<span class="p">)</span></code></pre></figure>

<h2 id="main-app-implementation">Main app implementation</h2>

<p>Then in our main app, we scan for <code>NSPrincipalClass</code> in all of our included bundles , one just need to call the <code>Modules.autoregister()</code> method in application startup.</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">public</span> <span class="kd">enum</span> <span class="kt">Modules</span> <span class="p">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">func</span> <span class="nf">autoregister</span><span class="p">()</span> <span class="p">{</span>
          <span class="kt">Bundle</span><span class="o">.</span><span class="n">allFrameworks</span><span class="o">.</span><span class="nf">compactMap</span><span class="p">(\</span><span class="o">.</span><span class="n">principalClass</span><span class="p">)</span>
              <span class="o">.</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">clazz</span> <span class="k">in</span>
                  <span class="nf">autoregister</span><span class="p">(</span><span class="nv">clazz</span><span class="p">:</span> <span class="n">clazz</span><span class="p">)</span>
              <span class="p">}</span>
  <span class="p">}</span>
  <span class="kd">static</span> <span class="kd">func</span> <span class="nf">autoregister</span><span class="p">(</span><span class="nv">clazz</span><span class="p">:</span> <span class="kt">AnyClass</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">instance</span> <span class="o">=</span> <span class="n">clazz</span><span class="o">.</span><span class="nf">alloc</span><span class="p">()</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">module</span> <span class="o">=</span> <span class="n">instance</span> <span class="k">as?</span> <span class="kt">ModuleRegistration</span> <span class="p">{</span>
            <span class="n">module</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="nf">debug</span><span class="p">(</span><span class="s">"Doing registration for </span><span class="se">\(</span><span class="n">clazz</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="n">module</span><span class="o">.</span><span class="nf">register</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Our main app will then scan all included bundles, look for <code>NSPrincipalClass</code>, test if it matches the protocol requirement and then calls the registration function.</p>

<p>The declared dependencies in our frameworks are now properly registered inside our app context, dependency injection system or anything you can imagine.</p>

  </div><!-- /.entry-content -->
</article><!-- /.hentry -->



<article class="hentry" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    <div class="entry-meta"><span class="entry-date date published updated"><time datetime="2024-04-19T00:00:00+02:00" itemprop="datePublished"><a href="http://www.bloggure.info/Swift_VisibleForTesting_Macro">April 19, 2024</a></time></span><span class="author vcard" itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name" class="fn"><a href="http://www.bloggure.info/cgatay" title="About cgatay" itemprop="url">cgatay</a></span></span>&nbsp; &bull; &nbsp;<span class="entry-comments"><a href="http://www.bloggure.info/Swift_VisibleForTesting_Macro#disqus_thread">Comment</a></span></div><!-- /.entry-meta -->
    
      <h1 class="entry-title" itemprop="name"><a href="http://www.bloggure.info/Swift_VisibleForTesting_Macro" rel="bookmark" title="Swift macro : @VisibleForTesting" itemprop="url">Swift macro : @VisibleForTesting</a></h1>
    
  </header>
  <div class="entry-content" itemprop="description">
    <p>As an ancient Java developer, I‚Äôve learned to use a set of annotations to bring meta programming in my projects.</p>

<p>Meta programming can be considered as an orthogonal thing to your code, you can inject code to log things, to wrap execution in a transaction or simply provide some context to your fellow developer.</p>

<p>One of my favorite context providing annotation at this time was brought by Google-Annotations package : <a href="https://guava.dev/releases/19.0/api/docs/com/google/common/annotations/VisibleForTesting.html"><code>@VisibleForTesting</code></a></p>

<p>Its goal is rather simple: provide the context that the visibility of the variable / method is not as restricted as it should be, but this is for the sake of testing.</p>

<p>When going back to my loved XCode (just kidding), I miss these kind of useful information.</p>

<p>Of course you can add a comment, that maybe someone will read if he begins to wonder why the visibility is too important.</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="c1">// this method should be private but we want to access it from unit test code  </span>
<span class="kd">func</span> <span class="nf">doStuff</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span></code></pre></figure>

<p>You can also play with the deprecation annotation to trigger a warning (one more to add and parse with your eyes‚Ä¶)</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">@available</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">deprecated</span><span class="p">,</span> <span class="nv">message</span><span class="p">:</span> <span class="s">"This is visible for testing"</span><span class="p">)</span>  
<span class="k">var</span> <span class="nv">myState</span><span class="p">:</span> <span class="kt">State</span></code></pre></figure>

<p>But one thing I was really missing is the ability to really set the proper visibility on my fields while keeping the testability.</p>

<p>Recently, <a href="https://www.swift.org/blog/swift-5.9-released/">Swift 5.9 had added Macro support</a>. Macros can be seen as ways to generate code based on specific instructions (this brings back old Java-apt memories).</p>

<h1 id="macro-types">Macro types</h1>

<p>There are multiples macro types, whether they can attach to fields, and depending on what they can do:</p>

<ul>
  <li>Providing accessors</li>
  <li>Generating code alongside the annotated field</li>
  <li>Generating code ‚Äúin-place‚Äù</li>
</ul>

<p>There are two ways of calling macros :</p>

<ul>
  <li>Attached ones with <code>@MacroName</code></li>
  <li>Freeform ones with <code>#MacroName</code></li>
</ul>

<p>I will not enter the details of each type and implementation, you will see more on this later here and can scout on GitHub repositories for inspiration.</p>

<p>Attached macros are written with a leading @ and can generate code alongside some of our declaration. This allowed me to introduce my own <code>@VisibleForTesting</code> for swift implementation.</p>

<p>The idea behind this is really simple, generate specific code with public visibility that wraps call to the ‚Äúnon-exposed‚Äù real method.</p>

<p>This way we get the best of both worlds, we keep our fields private, we tell our colleagues that this field is available for testing and we are able to test it properly.</p>

<h1 id="what-does-it-look-like-">What does it look like ?</h1>

<p>To use this library, you need to add an SPM dependency on this repository: <a href="https://github.com/CedricGatay/SwiftMacroUtils">https://github.com/CedricGatay/SwiftMacroUtils</a></p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="o">.</span><span class="nf">package</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="s">"https://github.com/CedricGatay/SwiftMacroUtils"</span><span class="p">,</span> <span class="nv">branch</span><span class="p">:</span> <span class="s">"main"</span><span class="p">)</span></code></pre></figure>

<p>Then, let‚Äôs say you want to give access for testing to the name var of the Dog struct to your testing code, you simply need to do the following</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">struct</span> <span class="kt">Dog</span> <span class="p">{</span>
    <span class="kd">@VisibleForTesting</span>
    <span class="kd">private</span> <span class="k">var</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span>
<span class="p">}</span></code></pre></figure>

<p>Under the hood, the macro will generate a public accessor that you will be able to use in your tests</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">public</span> <span class="k">var</span> <span class="nv">__test_name</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span> <span class="p">{</span>
    <span class="k">get</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">name</span>
    <span class="p">}</span>
    <span class="k">set</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">newValue</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>The same goes for <code>let</code>, <code>func</code>, and <code>init</code> . The only specific thing to keep in mind that if you annotate a <code>class</code> initializer, you need to mark it as <code>required</code>, otherwise the build will fail (but a nice comment will tell you why).</p>

  </div><!-- /.entry-content -->
</article><!-- /.hentry -->



<article class="hentry" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    <div class="entry-meta"><span class="entry-date date published updated"><time datetime="2021-01-10T00:00:00+01:00" itemprop="datePublished"><a href="http://www.bloggure.info/iOS-DarkModeBackground-App-Switcher">January 10, 2021</a></time></span><span class="author vcard" itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name" class="fn"><a href="http://www.bloggure.info/cgatay" title="About cgatay" itemprop="url">cgatay</a></span></span>&nbsp; &bull; &nbsp;<span class="entry-comments"><a href="http://www.bloggure.info/iOS-DarkModeBackground-App-Switcher#disqus_thread">Comment</a></span></div><!-- /.entry-meta -->
    
      <h1 class="entry-title" itemprop="name"><a href="http://www.bloggure.info/iOS-DarkModeBackground-App-Switcher" rel="bookmark" title="Dark Mode iOS Snapshot" itemprop="url">Dark Mode iOS Snapshot</a></h1>
    
  </header>
  <div class="entry-content" itemprop="description">
    <h1 id="dark-mode-support">Dark mode support</h1>

<p>As you might know, iOS supports Dark mode since iOS 12. 
It is pretty straightforward to implement it by using dynamic colors. Either system provided ones or adjust them using trait collections.</p>

<h2 id="dynamically-switch">Dynamically switch</h2>

<p>At times, we can not rely on default colors but we have to listen for <code>traitCollection</code> changes in order to do what is appropriate for adapting the UI to the mode being active.</p>

<p>It is easy to do by checking current <code>traitCollection</code> :</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="k">override</span> <span class="kd">func</span> <span class="nf">traitCollectionDidChange</span><span class="p">(</span><span class="n">_</span> <span class="nv">previousTraitCollection</span><span class="p">:</span> <span class="kt">UITraitCollection</span><span class="p">?)</span> <span class="p">{</span>
    <span class="k">super</span><span class="o">.</span><span class="nf">traitCollectionDidChange</span><span class="p">(</span><span class="n">previousTraitCollection</span><span class="p">)</span>

    <span class="k">let</span> <span class="nv">userInterfaceStyle</span> <span class="o">=</span> <span class="n">traitCollection</span><span class="o">.</span><span class="n">userInterfaceStyle</span> 
    <span class="c1">// Either .unspecified, .light, or .dark</span>
<span class="p">}</span>
 </code></pre></figure>

<h2 id="app-switcher-tricks">App switcher tricks</h2>

<p>One thing that I was not aware is that iOS switches back and forth
between active mode and the complementary when the app goes to the background :</p>

<p>To have proper representation in application switcher, if the trait collection is changed, the OS takes a screenshot of your app using  <code>light</code> and <code>dark</code> schemes.</p>

<h2 id="consequences">Consequences</h2>

<p>This can lead to subtle problems, in my case, I was loading a specific stylesheet for MapBox, that, when loaded, was registering / refreshing elements on map. Thus, when the app was put to the background, a lot of things were happening, without a clear explanation (and the app was sometimes crashing due to the very fast switching between map stylesheets).</p>

<p>The workaround is rather simple : if the app is in the background we prevent loading the stylesheet, the trade-off is acceptable : the app can display an 
invalid preview in application switcher, but, it is nicer on CPU / Network.</p>

  </div><!-- /.entry-content -->
</article><!-- /.hentry -->



<div class="pagination">
  
    Previous
  
  <ul class="inline-list">
    <li>
      
        <span class="current-page">1</span>
      
    </li>
    
      <li>
        
          <a href="http://www.bloggure.info/page2">2</a>
        
      </li>
    
      <li>
        
          <a href="http://www.bloggure.info/page3">3</a>
        
      </li>
    
      <li>
        
          <a href="http://www.bloggure.info/page4">4</a>
        
      </li>
    
      <li>
        
          <a href="http://www.bloggure.info/page5">5</a>
        
      </li>
    
      <li>
        
          <a href="http://www.bloggure.info/page6">6</a>
        
      </li>
    
      <li>
        
          <a href="http://www.bloggure.info/page7">7</a>
        
      </li>
    
      <li>
        
          <a href="http://www.bloggure.info/page8">8</a>
        
      </li>
    
      <li>
        
          <a href="http://www.bloggure.info/page9">9</a>
        
      </li>
    
      <li>
        
          <a href="http://www.bloggure.info/page10">10</a>
        
      </li>
    
      <li>
        
          <a href="http://www.bloggure.info/page11">11</a>
        
      </li>
    
      <li>
        
          <a href="http://www.bloggure.info/page12">12</a>
        
      </li>
    
      <li>
        
          <a href="http://www.bloggure.info/page13">13</a>
        
      </li>
    
      <li>
        
          <a href="http://www.bloggure.info/page14">14</a>
        
      </li>
    
      <li>
        
          <a href="http://www.bloggure.info/page15">15</a>
        
      </li>
    
      <li>
        
          <a href="http://www.bloggure.info/page16">16</a>
        
      </li>
    
      <li>
        
          <a href="http://www.bloggure.info/page17">17</a>
        
      </li>
    
      <li>
        
          <a href="http://www.bloggure.info/page18">18</a>
        
      </li>
    
      <li>
        
          <a href="http://www.bloggure.info/page19">19</a>
        
      </li>
    
      <li>
        
          <a href="http://www.bloggure.info/page20">20</a>
        
      </li>
    
      <li>
        
          <a href="http://www.bloggure.info/page21">21</a>
        
      </li>
    
  </ul>
  
    <a href="http://www.bloggure.info/page2" class="btn">Next</a>
  

</div>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2026 . Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using a theme based on <a href="https://mademistakes.com/work/hpstr-jekyll-theme/" rel="nofollow">HPSTR</a>.</span>
  </footer>
</div><!-- /.footer-wrapper -->

<script>
  (function() {
    function loadScript(src) {
      return new Promise(function(resolve, reject) {
        var script = document.createElement('script');
        script.src = src;
        script.defer = true;
        script.async = false;
        script.onload = resolve;
        script.onerror = reject;
        document.head.appendChild(script);
      });
    }

    var jqCdn = '//ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js';
    var jqLocal = 'http://www.bloggure.info/assets/js/vendor/jquery-3.7.1.min.js';
    var needFitVids = document.querySelector('article iframe, article video');
    var needMagnific = document.querySelector(
      'a[href$=".jpg" i],a[href$=".jpeg" i],a[href$=".png" i],a[href$=".gif" i]'
    );

    var jqPromise = loadScript(jqCdn)
      .catch(function() {
        return loadScript(jqLocal);
      })
      .then(function() {
        if (!window.jQuery) {
          return loadScript(jqLocal);
        }
      });

    jqPromise
      .then(function() {
        var chain = Promise.resolve();
        
        return chain;
      })
      .then(function() {
        return loadScript('http://www.bloggure.info/assets/js/scripts.min.js');
      });
  })();
</script>


<!-- Asynchronous Google Analytics snippet -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-11718843-3', 'auto');  
  ga('require', 'linkid', 'linkid.js');
  ga('send', 'pageview');
</script>



    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'thereisnoplacelike1'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script'); s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

          

</body>
</html>