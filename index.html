<!DOCTYPE html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en">
  <!--<![endif]-->
  <head>
    <meta charset="utf-8" />
    <title>Bloggure</title>
    <meta
      name="description"
      content="Multi author blog about programming, computing and geek stuff"
    />

    <!-- Open Graph -->
    <meta property="og:locale" content="en_US" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Bloggure" />
    <meta
      property="og:description"
      content="Multi author blog about programming, computing and geek stuff"
    />
    <meta property="og:url" content="http://www.bloggure.info/" />
    <meta property="og:site_name" content="Bloggure" />

    <link rel="canonical" href="http://www.bloggure.info/" />
    <link
      href="http://www.bloggure.info/feed.xml"
      type="application/atom+xml"
      rel="alternate"
      title="Bloggure Feed"
    />

    <!-- http://t.co/dKP3o1e -->
    <meta name="HandheldFriendly" content="True" />
    <meta name="MobileOptimized" content="320" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- For all browsers -->
    <link
      rel="stylesheet"
      href="http://www.bloggure.info/assets/css/main.css"
    />
    <!-- Webfonts -->
    <link
      href="https://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic"
      rel="stylesheet"
      type="text/css"
    />

    <meta http-equiv="cleartype" content="on" />

    <!-- Load Modernizr -->
    <script src="http://www.bloggure.info/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

    <!-- Icons -->
    <!-- 16x16 -->
    <link rel="shortcut icon" href="http://www.bloggure.info/favicon.ico" />
    <!-- 32x32 -->
    <link rel="shortcut icon" href="http://www.bloggure.info/favicon.png" />
    <!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
    <link
      rel="apple-touch-icon-precomposed"
      href="http://www.bloggure.info/images/apple-touch-icon-precomposed.png"
    />
    <!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
    <link
      rel="apple-touch-icon-precomposed"
      sizes="72x72"
      href="http://www.bloggure.info/images/apple-touch-icon-72x72-precomposed.png"
    />
    <!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
    <link
      rel="apple-touch-icon-precomposed"
      sizes="114x114"
      href="http://www.bloggure.info/images/apple-touch-icon-114x114-precomposed.png"
    />
    <!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
    <link
      rel="apple-touch-icon-precomposed"
      sizes="144x144"
      href="http://www.bloggure.info/images/apple-touch-icon-144x144-precomposed.png"
    />
  </head>

  <body id="post-index">
    <!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->

    <div class="entry-header">
      <div class="header-title">
        <div class="header-title-wrap">
          <h1>Bloggure</h1>
          <h2></h2>
        </div>
        <!-- /.header-title-wrap -->
      </div>
      <!-- /.header-title -->
    </div>
    <!-- /.entry-header -->

    <div id="main" role="main">
      <article
        class="hentry"
        itemprop="blogPost"
        itemscope
        itemtype="http://schema.org/BlogPosting"
      >
        <header>
          <div class="entry-meta">
            <span class="entry-date date published updated"
              ><time
                datetime="2024-04-19T00:00:00+02:00"
                itemprop="datePublished"
                ><a
                  href="http://www.bloggure.info/Swift_VisibleForTesting_Macro"
                  >April 19, 2024</a
                ></time
              ></span
            ><span
              class="author vcard"
              itemprop="author"
              itemscope
              itemtype="http://schema.org/Person"
              ><span itemprop="name" class="fn"
                ><a
                  href="http://www.bloggure.info/cgatay"
                  title="About cgatay"
                  itemprop="url"
                  >cgatay</a
                ></span
              ></span
            >&nbsp; &bull; &nbsp;<span class="entry-comments"
              ><a
                href="http://www.bloggure.info/Swift_VisibleForTesting_Macro#disqus_thread"
                >Comment</a
              ></span
            >
          </div>
          <!-- /.entry-meta -->

          <h1 class="entry-title" itemprop="name">
            <a
              href="http://www.bloggure.info/Swift_VisibleForTesting_Macro"
              rel="bookmark"
              title="Swift macro : @VisibleForTesting"
              itemprop="url"
              >Swift macro : @VisibleForTesting</a
            >
          </h1>
        </header>
        <div class="entry-content" itemprop="description">
          <p>
            As an ancient Java developer, I’ve learned to use a set of
            annotations to bring meta programming in my projects.
          </p>

          <p>
            Meta programming can be considered as an orthogonal thing to your
            code, you can inject code to log things, to wrap execution in a
            transaction or simply provide some context to your fellow developer.
          </p>

          <p>
            One of my favorite context providing annotation at this time was
            brought by Google-Annotations package :
            <a
              href="https://guava.dev/releases/19.0/api/docs/com/google/common/annotations/VisibleForTesting.html"
              ><code>@VisibleForTesting</code></a
            >
          </p>

          <p>
            Its goal is rather simple: provide the context that the visibility
            of the variable / method is not as restricted as it should be, but
            this is for the sake of testing.
          </p>

          <p>
            When going back to my loved XCode (just kidding), I miss these kind
            of useful information.
          </p>

          <p>
            Of course you can add a comment, that maybe someone will read if he
            begins to wonder why the visibility is too important.
          </p>

          <figure class="highlight">
            <pre><code class="language-swift" data-lang="swift"><span></span><span class="c1">// this method should be private but we want to access it from unit test code  </span>
<span class="kd">func</span> <span class="nf">doStuff</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span></code></pre>
          </figure>

          <p>
            You can also play with the deprecation annotation to trigger a
            warning (one more to add and parse with your eyes…)
          </p>

          <figure class="highlight">
            <pre><code class="language-swift" data-lang="swift"><span></span><span class="p">@</span><span class="n">available</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">deprecated</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="s">&quot;This is visible for testing&quot;</span><span class="p">)</span>  
<span class="kd">var</span> <span class="nv">myState</span><span class="p">:</span> <span class="n">State</span></code></pre>
          </figure>

          <p>
            But one thing I was really missing is the ability to really set the
            proper visibility on my fields while keeping the testability.
          </p>

          <p>
            Recently,
            <a href="https://www.swift.org/blog/swift-5.9-released/"
              >Swift 5.9 had added Macro support</a
            >. Macros can be seen as ways to generate code based on specific
            instructions (this brings back old Java-apt memories).
          </p>

          <h1 id="macro-types">Macro types</h1>

          <p>
            There are multiples macro types, whether they can attach to fields,
            and depending on what they can do:
          </p>

          <ul>
            <li>Providing accessors</li>
            <li>Generating code alongside the annotated field</li>
            <li>Generating code “in-place”</li>
          </ul>

          <p>There are two ways of calling macros :</p>

          <ul>
            <li>Attached ones with <code>@MacroName</code></li>
            <li>Freeform ones with <code>#MacroName</code></li>
          </ul>

          <p>
            I will not enter the details of each type and implementation, you
            will see more on this later here and can scout on GitHub
            repositories for inspiration.
          </p>

          <p>
            Attached macros are written with a leading @ and can generate code
            alongside some of our declaration. This allowed me to introduce my
            own <code>@VisibleForTesting</code> for swift implementation.
          </p>

          <p>
            The idea behind this is really simple, generate specific code with
            public visibility that wraps call to the “non-exposed” real method.
          </p>

          <p>
            This way we get the best of both worlds, we keep our fields private,
            we tell our colleagues that this field is available for testing and
            we are able to test it properly.
          </p>

          <h1 id="what-does-it-look-like-">What does it look like ?</h1>

          <p>
            To use this library, you need to add an SPM dependency on this
            repository:
            <a href="https://github.com/CedricGatay/SwiftMacroUtils"
              >https://github.com/CedricGatay/SwiftMacroUtils</a
            >
          </p>

          <figure class="highlight">
            <pre><code class="language-swift" data-lang="swift"><span></span><span class="p">.</span><span class="n">package</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="s">&quot;https://github.com/CedricGatay/SwiftMacroUtils&quot;</span><span class="p">,</span> <span class="n">branch</span><span class="p">:</span> <span class="s">&quot;main&quot;</span><span class="p">)</span></code></pre>
          </figure>

          <p>
            Then, let’s say you want to give access for testing to the name var
            of the Dog struct to your testing code, you simply need to do the
            following
          </p>

          <figure class="highlight">
            <pre><code class="language-swift" data-lang="swift"><span></span><span class="kd">struct</span> <span class="nc">Dog</span> <span class="p">{</span>
    <span class="p">@</span><span class="n">VisibleForTesting</span>
    <span class="kd">private</span> <span class="kd">var</span> <span class="nv">name</span><span class="p">:</span> <span class="nb">String</span><span class="p">?</span>
<span class="p">}</span></code></pre>
          </figure>

          <p>
            Under the hood, the macro will generate a public accessor that you
            will be able to use in your tests
          </p>

          <figure class="highlight">
            <pre><code class="language-swift" data-lang="swift"><span></span><span class="kd">public</span> <span class="kd">var</span> <span class="nv">__test_name</span><span class="p">:</span> <span class="nb">String</span><span class="p">?</span> <span class="p">{</span>
    <span class="kr">get</span> <span class="p">{</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">name</span>
    <span class="p">}</span>
    <span class="kr">set</span> <span class="p">{</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">name</span> <span class="p">=</span> <span class="n">newValue</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre>
          </figure>

          <p>
            The same goes for <code>let</code>, <code>func</code>, and
            <code>init</code> . The only specific thing to keep in mind that if
            you annotate a <code>class</code> initializer, you need to mark it
            as <code>required</code>, otherwise the build will fail (but a nice
            comment will tell you why).
          </p>
        </div>
        <!-- /.entry-content -->
      </article>
      <!-- /.hentry -->

      <article
        class="hentry"
        itemprop="blogPost"
        itemscope
        itemtype="http://schema.org/BlogPosting"
      >
        <header>
          <div class="entry-meta">
            <span class="entry-date date published updated"
              ><time
                datetime="2021-01-10T00:00:00+01:00"
                itemprop="datePublished"
                ><a
                  href="http://www.bloggure.info/iOS-DarkModeBackground-App-Switcher"
                  >January 10, 2021</a
                ></time
              ></span
            ><span
              class="author vcard"
              itemprop="author"
              itemscope
              itemtype="http://schema.org/Person"
              ><span itemprop="name" class="fn"
                ><a
                  href="http://www.bloggure.info/cgatay"
                  title="About cgatay"
                  itemprop="url"
                  >cgatay</a
                ></span
              ></span
            >&nbsp; &bull; &nbsp;<span class="entry-comments"
              ><a
                href="http://www.bloggure.info/iOS-DarkModeBackground-App-Switcher#disqus_thread"
                >Comment</a
              ></span
            >
          </div>
          <!-- /.entry-meta -->

          <h1 class="entry-title" itemprop="name">
            <a
              href="http://www.bloggure.info/iOS-DarkModeBackground-App-Switcher"
              rel="bookmark"
              title="Dark Mode iOS Snapshot"
              itemprop="url"
              >Dark Mode iOS Snapshot</a
            >
          </h1>
        </header>
        <div class="entry-content" itemprop="description">
          <h1 id="dark-mode-support">Dark mode support</h1>

          <p>
            As you might know, iOS supports Dark mode since iOS 12. It is pretty
            straightforward to implement it by using dynamic colors. Either
            system provided ones or adjust them using trait collections.
          </p>

          <h2 id="dynamically-switch">Dynamically switch</h2>

          <p>
            At times, we can not rely on default colors but we have to listen
            for <code>traitCollection</code> changes in order to do what is
            appropriate for adapting the UI to the mode being active.
          </p>

          <p>
            It is easy to do by checking current <code>traitCollection</code> :
          </p>

          <figure class="highlight">
            <pre><code class="language-swift" data-lang="swift"><span></span><span class="kr">override</span> <span class="kd">func</span> <span class="nf">traitCollectionDidChange</span><span class="p">(</span><span class="kc">_</span> <span class="n">previousTraitCollection</span><span class="p">:</span> <span class="bp">UITraitCollection</span><span class="p">?)</span> <span class="p">{</span>
    <span class="kc">super</span><span class="p">.</span><span class="n">traitCollectionDidChange</span><span class="p">(</span><span class="n">previousTraitCollection</span><span class="p">)</span>

    <span class="kd">let</span> <span class="nv">userInterfaceStyle</span> <span class="p">=</span> <span class="n">traitCollection</span><span class="p">.</span><span class="n">userInterfaceStyle</span> 
    <span class="c1">// Either .unspecified, .light, or .dark</span>
<span class="p">}</span>
 </code></pre>
          </figure>

          <h2 id="app-switcher-tricks">App switcher tricks</h2>

          <p>
            One thing that I was not aware is that iOS switches back and forth
            between active mode and the complementary when the app goes to the
            background :
          </p>

          <p>
            To have proper representation in application switcher, if the trait
            collection is changed, the OS takes a screenshot of your app using
            <code>light</code> and <code>dark</code> schemes.
          </p>

          <h2 id="consequences">Consequences</h2>

          <p>
            This can lead to subtle problems, in my case, I was loading a
            specific stylesheet for MapBox, that, when loaded, was registering /
            refreshing elements on map. Thus, when the app was put to the
            background, a lot of things were happening, without a clear
            explanation (and the app was sometimes crashing due to the very fast
            switching between map stylesheets).
          </p>

          <p>
            The workaround is rather simple : if the app is in the background we
            prevent loading the stylesheet, the trade-off is acceptable : the
            app can display an invalid preview in application switcher, but, it
            is nicer on CPU / Network.
          </p>
        </div>
        <!-- /.entry-content -->
      </article>
      <!-- /.hentry -->

      <article
        class="hentry"
        itemprop="blogPost"
        itemscope
        itemtype="http://schema.org/BlogPosting"
      >
        <header>
          <div class="entry-meta">
            <span class="entry-date date published updated"
              ><time
                datetime="2020-12-31T00:00:00+01:00"
                itemprop="datePublished"
                ><a href="http://www.bloggure.info/git-gone"
                  >December 31, 2020</a
                ></time
              ></span
            ><span
              class="author vcard"
              itemprop="author"
              itemscope
              itemtype="http://schema.org/Person"
              ><span itemprop="name" class="fn"
                ><a
                  href="http://www.bloggure.info/cgatay"
                  title="About cgatay"
                  itemprop="url"
                  >cgatay</a
                ></span
              ></span
            >&nbsp; &bull; &nbsp;<span class="entry-comments"
              ><a href="http://www.bloggure.info/git-gone#disqus_thread"
                >Comment</a
              ></span
            >
          </div>
          <!-- /.entry-meta -->

          <h1 class="entry-title" itemprop="name">
            <a
              href="http://www.bloggure.info/git-gone"
              rel="bookmark"
              title="Git-gone"
              itemprop="url"
              >Git-gone</a
            >
          </h1>
        </header>
        <div class="entry-content" itemprop="description">
          <h1 id="git-daily-usage">Git daily usage</h1>

          <p>
            If you’re like most developers nowadays you make an extensive usage
            of <code>git</code> across a large number of repositories.
          </p>

          <p>
            The now-classic branching model that consists in using a branch for
            every fix / feature / experiment before creating a merge request is
            perfect for collaborating efficiently. However it comes with one
            downside, local branches can quickly become messy and removing stale
            branches is not that easy
          </p>

          <h2 id="removing-remote-branches">Removing remote branches</h2>

          <p>
            <code>git</code> is a really well designed tool and removing remote
            references from your local repository is easily done by
          </p>

          <figure class="highlight">
            <pre><code class="language-shell" data-lang="shell"><span></span>git<span class="w"> </span>remote<span class="w"> </span>prune<span class="w"> </span>origin</code></pre>
          </figure>

          <p>
            This will remove local references to non existing branches, however
            it is not useful to remember this command, we can configure
            <code>git</code> so that it prunes automatically on fetching :
          </p>

          <figure class="highlight">
            <pre><code class="language-shell" data-lang="shell"><span></span>git<span class="w"> </span>config<span class="w"> </span>--global<span class="w"> </span>fetch.prune<span class="w"> </span><span class="nb">true</span></code></pre>
          </figure>

          <h2 id="removing-local-branches">Removing local branches</h2>

          <p>
            This is where things can be quite messy, as local branches might
            have been merged, rebased, or squashed, and “classic” commands
            allowing to detected merged branches are not always working as they
            ought.
          </p>

          <p>
            If you search how to clean up local branches, you might find a lot
            of commands involving <code>git branch --merged</code> with
            <code>grep</code> and <code>xargs</code> all the way.
          </p>

          <p>
            I found out a little neat tool to do so, called
            <a href="https://github.com/lunaryorn/git-gone"
              ><code>git-gone</code> (github/lunaryorn/git-gone)</a
            >, written in Rust 🧡
          </p>

          <h3 id="install-it">Install it</h3>

          <p>
            As all rust project, it is packaged and easy to install using cargo
          </p>

          <figure class="highlight">
            <pre><code class="language-swift" data-lang="swift"><span></span><span class="n">cargo</span> <span class="n">install</span> <span class="n">git</span><span class="o">-</span><span class="n">gone</span></code></pre>
          </figure>

          <h3 id="list-branches-to-prune">List branches to prune</h3>

          <p>
            Before doing anything silly, we can list the branches that are
            candidate to removal (the <code>-f</code> flag forces fetching
            remote)
          </p>

          <figure class="highlight">
            <pre><code class="language-swift" data-lang="swift"><span></span><span class="err">$</span> <span class="n">git</span> <span class="n">gone</span> <span class="o">-</span><span class="n">f</span> <span class="n">list</span>
<span class="n">feature</span><span class="o">/</span><span class="n">asciidoc</span>
<span class="n">fix</span><span class="o">/</span><span class="n">imageCompress</span></code></pre>
          </figure>

          <h3 id="pruneem-all">Prune’em all</h3>

          <p>
            And finally, you can remove them (the <code>-f</code> flag is still
            here to sync with remote)
          </p>

          <figure class="highlight">
            <pre><code class="language-swift" data-lang="swift"><span></span><span class="err">$</span> <span class="n">git</span> <span class="n">gone</span> <span class="o">-</span><span class="n">f</span> <span class="n">prune</span>
<span class="n">Deleted</span> <span class="n">feature</span><span class="o">/</span><span class="n">asciidoc</span> <span class="p">(</span><span class="n">restore</span> <span class="n">with</span> <span class="p">`</span><span class="n">git</span> <span class="n">checkout</span> <span class="o">-</span><span class="n">b</span> <span class="n">feature</span><span class="o">/</span><span class="n">asciidoc</span> <span class="mi">8</span><span class="n">f007a</span><span class="p">`)</span>
<span class="n">Deleted</span> <span class="n">fix</span><span class="o">/</span><span class="n">imageCompress</span> <span class="p">(</span><span class="n">restore</span> <span class="n">with</span> <span class="p">`</span><span class="n">git</span> <span class="n">checkout</span> <span class="o">-</span><span class="n">b</span> <span class="n">fix</span><span class="o">/</span><span class="n">imageCompress</span> <span class="n">af523b</span><span class="p">`)</span></code></pre>
          </figure>

          <p>
            <code>git-gone</code> is even clever enough to give you the command
            to restore a branch if change your mind (as long as you did not
            <code>git gc</code> the revision is still available locally, so you
            can restore it)
          </p>
        </div>
        <!-- /.entry-content -->
      </article>
      <!-- /.hentry -->

      <article
        class="hentry"
        itemprop="blogPost"
        itemscope
        itemtype="http://schema.org/BlogPosting"
      >
        <header>
          <div class="entry-meta">
            <span class="entry-date date published updated"
              ><time
                datetime="2020-12-06T00:00:00+01:00"
                itemprop="datePublished"
                ><a href="http://www.bloggure.info/mac-checklist"
                  >December 06, 2020</a
                ></time
              ></span
            ><span
              class="author vcard"
              itemprop="author"
              itemscope
              itemtype="http://schema.org/Person"
              ><span itemprop="name" class="fn"
                ><a
                  href="http://www.bloggure.info/cgatay"
                  title="About cgatay"
                  itemprop="url"
                  >cgatay</a
                ></span
              ></span
            >&nbsp; &bull; &nbsp;<span class="entry-comments"
              ><a href="http://www.bloggure.info/mac-checklist#disqus_thread"
                >Comment</a
              ></span
            >
          </div>
          <!-- /.entry-meta -->

          <h1 class="entry-title" itemprop="name">
            <a
              href="http://www.bloggure.info/mac-checklist"
              rel="bookmark"
              title="macOS tools checklist"
              itemprop="url"
              >macOS tools checklist</a
            >
          </h1>
        </header>
        <div class="entry-content" itemprop="description">
          <h1 id="welcome-to-the-mac-world">Welcome to the mac world</h1>

          <p>
            Wether you’re new to macOS or an user coming from different
            machines, the tools we tend to use is very important to be
            productive.
          </p>

          <p>
            Here you’ll find my list and what I install on a fresh machine to
            get started.
          </p>

          <h2 id="system-tools">System tools</h2>

          <p>
            First and foremost, I start with
            <a href="https://brew.sh"><code>brew</code></a> to handle all my
            packages, but instead of doing so manually, I use my
            <a href="https://github.com/CedricGatay/dotfiles.git"
              ><code>dotfiles</code></a
            >
            and my “magic” install script that does all the heavy lifting for
            me.
          </p>

          <h2 id="keyboard-tools">Keyboard tools</h2>

          <p>
            I use a TypeMatrix with a Colemak layout and also the internal
            keyboard of my laptop with its default layout. Colemak layout is
            available on a fresh macOS install but it is far from perfect as
            there are a lot of missing dead keys (to type accented letters
            mainly), so I start by installing the layout provided on this page:
            <a href="https://colemak.com/Mac">Colemak mac</a>
          </p>

          <p>
            To easily switch between the two and get almost the same feeling, I
            use
            <a href="http://karabiner-elements.pqrs.org/">Karabiner Elements</a
            >.
          </p>

          <h2 id="everyday-tools">Everyday tools</h2>

          <ul>
            <li>
              <a href="https://sdkman.io">sdkman</a>: to manage installation of
              various sdk (mainly Java based)
            </li>
            <li>
              <a href="https://iterm2.com">iTerm</a>: nice terminal app with
              profiles
            </li>
            <li>
              <a href="https://github.com/tmux/tmux/wiki">tmux</a>: multi
              terminal in one window, switching terminal with a keystroke
            </li>
            <li><a href="https://www.zsh.org">zsh</a>: Z-Shell</li>
            <li>
              <a href="https://starship.rs">starship</a>: fast shell prompt
            </li>
            <li>
              <a href="https://github.com/BurntSushi/ripgrep">ripgrep</a>:
              faster <code>grep</code>
            </li>
            <li>
              <a href="https://github.com/sharkdp/bat">bat</a>: nice
              <code>cat</code> alternative (with paging / highlighting)
            </li>
            <li>
              <a href="https://github.com/ogham/exa">exa</a>: replacement for
              <code>ls</code>
            </li>
            <li>
              <a href="https://www.alfredapp.com">Alfred</a>: Spotlight with
              more features, this is my main app launcher / switcher
            </li>
            <li>
              <a href="https://go.setapp.com/invite/cgatay">SetApp</a>: App
              subscription service, use many tools from this (BetterTouchTool,
              iStat, BarTender…)
            </li>
          </ul>
        </div>
        <!-- /.entry-content -->
      </article>
      <!-- /.hentry -->

      <article
        class="hentry"
        itemprop="blogPost"
        itemscope
        itemtype="http://schema.org/BlogPosting"
      >
        <header>
          <div class="entry-meta">
            <span class="entry-date date published updated"
              ><time
                datetime="2020-12-03T00:00:00+01:00"
                itemprop="datePublished"
                ><a href="http://www.bloggure.info/SwiftUI-UIKit_Interop"
                  >December 03, 2020</a
                ></time
              ></span
            ><span
              class="author vcard"
              itemprop="author"
              itemscope
              itemtype="http://schema.org/Person"
              ><span itemprop="name" class="fn"
                ><a
                  href="http://www.bloggure.info/cgatay"
                  title="About cgatay"
                  itemprop="url"
                  >cgatay</a
                ></span
              ></span
            >&nbsp; &bull; &nbsp;<span class="entry-comments"
              ><a
                href="http://www.bloggure.info/SwiftUI-UIKit_Interop#disqus_thread"
                >Comment</a
              ></span
            >
          </div>
          <!-- /.entry-meta -->

          <h1 class="entry-title" itemprop="name">
            <a
              href="http://www.bloggure.info/SwiftUI-UIKit_Interop"
              rel="bookmark"
              title="SwiftUI UIKit Interop"
              itemprop="url"
              >SwiftUI UIKit Interop</a
            >
          </h1>
        </header>
        <div class="entry-content" itemprop="description">
          <p>
            Now that iOS13 is available for more than year, we can start to set
            it as a lower bound for our deployments.
          </p>

          <p>
            This allows us to play with all sugar that Apple put in it, one of
            the biggest thing is the arrival of SwiftUI to supercede UIKit
            (write cross platform UIs and so on).
          </p>

          <h2 id="bridging-the-two-worlds">Bridging the two worlds</h2>

          <h3 id="using-swiftui-from-uikit">Using SwiftUI from UIKit</h3>

          <p>
            The first thing we might try to do, is embedding a SwiftUI View
            inside our <code>UIViewController</code> based application. To do
            so, Apple gives us <code>UIHostingViewController</code> which is a
            simple bridging controller, straightforward to use.
          </p>

          <figure class="highlight">
            <pre><code class="language-swift" data-lang="swift"><span></span><span class="kd">struct</span> <span class="nc">MyNewView</span><span class="p">:</span> <span class="n">View</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">view</span><span class="p">:</span> <span class="n">some</span> <span class="n">View</span> <span class="p">{</span>
        <span class="n">Text</span><span class="p">(</span><span class="s">&quot;I&#39;m in SwiftUI&quot;</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="kd">class</span> <span class="nc">MyNewViewViewController</span><span class="p">:</span> <span class="n">UIHostingViewController</span> <span class="p">{</span>
    <span class="kd">init</span><span class="p">(){</span>
        <span class="kc">super</span><span class="p">.</span><span class="kd">init</span><span class="p">(</span><span class="n">rootView</span><span class="p">:</span> <span class="n">MyNewView</span><span class="p">())</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre>
          </figure>

          <h3 id="uiviewcontroller-in-swiftui">UIViewController in SwiftUI</h3>

          <p>
            However, at times we still need to reuse our good old
            <code>UIViewController</code>, either because we can not afford a
            full SwiftUI rewrite, so we want to keep old code and migrate pieces
            by pieces or because we are using something not yet adapted to
            SwiftUI.
          </p>

          <p>In my case it was using the camera to scan a QRCode.</p>

          <h4 id="non-elegant-solution">Non elegant solution</h4>

          <p>
            I faced a few issue with examples I found out, most of them are
            adding an extension to the <code>UIViewController</code> that makes
            it conform to <code>UIViewControllerRepresentable</code>.
          </p>

          <figure class="highlight">
            <pre><code class="language-swift" data-lang="swift"><span></span><span class="kd">class</span> <span class="nc">MyViewController</span><span class="p">:</span> <span class="bp">UIViewController</span><span class="p">{</span>
    <span class="kd">var</span> <span class="nv">cancellable</span><span class="p">:</span> <span class="n">Cancellable</span><span class="p">?</span>
    <span class="c1">// classic stuff</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="nc">MyViewController</span><span class="p">:</span> <span class="n">UIViewControllerRepresentable</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kd">typealias</span> <span class="n">UIViewControllerType</span> <span class="p">=</span> <span class="n">MyViewController</span>

    <span class="kd">public</span> <span class="kd">func</span> <span class="nf">makeUIViewController</span><span class="p">(</span><span class="n">context</span> <span class="kc">_</span><span class="p">:</span> <span class="n">UIViewControllerRepresentableContext</span><span class="p">&lt;</span><span class="n">MyViewController</span><span class="p">&gt;)</span> <span class="p">-&gt;</span> <span class="n">UIViewControllerType</span> <span class="p">{</span>
        <span class="kc">self</span> <span class="c1">// don&#39;t .init() please, class instance is already available</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kd">func</span> <span class="nf">updateUIViewController</span><span class="p">(</span><span class="kc">_</span><span class="p">:</span> <span class="n">UIViewControllerType</span><span class="p">,</span> <span class="n">context</span> <span class="kc">_</span><span class="p">:</span> <span class="n">UIViewControllerRepresentableContext</span><span class="p">&lt;</span><span class="n">MyViewController</span><span class="p">&gt;)</span> <span class="p">{}</span>

    <span class="kd">static</span> <span class="kd">func</span> <span class="nf">dismantleUIViewController</span><span class="p">(</span><span class="kc">_</span> <span class="n">uiViewController</span><span class="p">:</span> <span class="n">UIViewControllerType</span><span class="p">,</span> <span class="n">coordinator</span> <span class="kc">_</span><span class="p">:</span> <span class="n">Coordinator</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">uiViewController</span><span class="p">.</span><span class="n">cancellable</span><span class="p">?.</span><span class="n">cancel</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="nc">MyView</span><span class="p">:</span> <span class="n">View</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nv">body</span><span class="p">:</span> <span class="n">some</span> <span class="n">View</span> <span class="p">{</span>
    <span class="n">MyViewController</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre>
          </figure>

          <p>
            I find this not easy to read, as we’re doing weird thing by
            returning <code>self</code> from a function named
            <code>makeUIViewController</code>. Some example are telling to
            return <code>MyViewController()</code> instead of <code>self</code>.
            Please don’t do this otherwise you’re creating the
            <code>UIViewController</code> twice for each call !
          </p>

          <p>
            I also had a leak when using <code>Combine</code> (more to come
            about this great framework), my <code>Cancellable</code>s were never
            freed, leading in a memory cycle that kept the
            <code>UIViewController</code> living even though it was no longer
            presented.
          </p>

          <p>
            It is important to do proper house keeping in the
            <code>dismantleUIViewController</code> method if you don’t want to
            use too much memory and slow down your app.
          </p>

          <h4 id="nice-looking-way-of-doing">Nice looking way of doing</h4>

          <p>
            You will find a working example below, basically we need to
            implement a <code>UIViewControllerRepresentable</code> struct to
            represent be the container for our <code>UIViewController</code> in
            the SwiftUI world.
          </p>

          <figure class="highlight">
            <pre><code class="language-swift" data-lang="swift"><span></span><span class="kd">class</span> <span class="nc">MyViewController</span><span class="p">:</span> <span class="bp">UIViewController</span><span class="p">{</span>
    <span class="kd">var</span> <span class="nv">cancellable</span><span class="p">:</span> <span class="n">Cancellable</span><span class="p">?</span>
    <span class="c1">// classic stuff</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="nc">MyGreatView</span><span class="p">:</span> <span class="n">UIViewControllerRepresentable</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kd">typealias</span> <span class="n">UIViewControllerType</span> <span class="p">=</span> <span class="n">MyViewController</span>

    <span class="kd">public</span> <span class="kd">func</span> <span class="nf">makeUIViewController</span><span class="p">(</span><span class="n">context</span> <span class="kc">_</span><span class="p">:</span> <span class="n">UIViewControllerRepresentableContext</span><span class="p">&lt;</span><span class="n">MyGreatView</span><span class="p">&gt;)</span> <span class="p">-&gt;</span> <span class="n">UIViewControllerType</span> <span class="p">{</span>
        <span class="n">MyViewController</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kd">func</span> <span class="nf">updateUIViewController</span><span class="p">(</span><span class="kc">_</span><span class="p">:</span> <span class="n">UIViewControllerType</span><span class="p">,</span> <span class="n">context</span> <span class="kc">_</span><span class="p">:</span> <span class="n">UIViewControllerRepresentableContext</span><span class="p">&lt;</span><span class="n">MyGreatView</span><span class="p">&gt;)</span> <span class="p">{}</span>

    <span class="kd">static</span> <span class="kd">func</span> <span class="nf">dismantleUIViewController</span><span class="p">(</span><span class="kc">_</span> <span class="n">uiViewController</span><span class="p">:</span> <span class="n">UIViewControllerType</span><span class="p">,</span> <span class="n">coordinator</span> <span class="kc">_</span><span class="p">:</span> <span class="n">Coordinator</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">uiViewController</span><span class="p">.</span><span class="n">cancellable</span><span class="p">?.</span><span class="n">cancel</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="nc">MyView</span><span class="p">:</span> <span class="n">View</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nv">body</span><span class="p">:</span> <span class="n">some</span> <span class="n">View</span> <span class="p">{</span>
    <span class="n">MyGreatView</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre>
          </figure>
        </div>
        <!-- /.entry-content -->
      </article>
      <!-- /.hentry -->

      <div class="pagination">
        Previous

        <ul class="inline-list">
          <li>
            <span class="current-page">1</span>
          </li>

          <li>
            <a href="http://www.bloggure.info/page2">2</a>
          </li>

          <li>
            <a href="http://www.bloggure.info/page3">3</a>
          </li>

          <li>
            <a href="http://www.bloggure.info/page4">4</a>
          </li>

          <li>
            <a href="http://www.bloggure.info/page5">5</a>
          </li>

          <li>
            <a href="http://www.bloggure.info/page6">6</a>
          </li>

          <li>
            <a href="http://www.bloggure.info/page7">7</a>
          </li>

          <li>
            <a href="http://www.bloggure.info/page8">8</a>
          </li>

          <li>
            <a href="http://www.bloggure.info/page9">9</a>
          </li>

          <li>
            <a href="http://www.bloggure.info/page10">10</a>
          </li>

          <li>
            <a href="http://www.bloggure.info/page11">11</a>
          </li>

          <li>
            <a href="http://www.bloggure.info/page12">12</a>
          </li>

          <li>
            <a href="http://www.bloggure.info/page13">13</a>
          </li>

          <li>
            <a href="http://www.bloggure.info/page14">14</a>
          </li>

          <li>
            <a href="http://www.bloggure.info/page15">15</a>
          </li>

          <li>
            <a href="http://www.bloggure.info/page16">16</a>
          </li>

          <li>
            <a href="http://www.bloggure.info/page17">17</a>
          </li>

          <li>
            <a href="http://www.bloggure.info/page18">18</a>
          </li>

          <li>
            <a href="http://www.bloggure.info/page19">19</a>
          </li>

          <li>
            <a href="http://www.bloggure.info/page20">20</a>
          </li>
        </ul>

        <a href="http://www.bloggure.info/page2" class="btn">Next</a>
      </div>
    </div>
    <!-- /#main -->

    <div class="footer-wrapper">
      <footer role="contentinfo">
        <span
          >&copy; 2024 . Powered by
          <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using a theme
          based on
          <a
            href="https://mademistakes.com/work/hpstr-jekyll-theme/"
            rel="nofollow"
            >HPSTR</a
          >.</span
        >
      </footer>
    </div>
    <!-- /.footer-wrapper -->

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script>
      window.jQuery ||
        document.write(
          '<script src="http://www.bloggure.info/assets/js/vendor/jquery-1.9.1.min.js"><\/script>'
        );
    </script>
    <script src="http://www.bloggure.info/assets/js/scripts.min.js"></script>

    <!-- Asynchronous Google Analytics snippet -->
    <script>
      (function (i, s, o, g, r, a, m) {
        i["GoogleAnalyticsObject"] = r;
        (i[r] =
          i[r] ||
          function () {
            (i[r].q = i[r].q || []).push(arguments);
          }),
          (i[r].l = 1 * new Date());
        (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m);
      })(
        window,
        document,
        "script",
        "//www.google-analytics.com/analytics.js",
        "ga"
      );

      ga("create", "UA-11718843-3", "auto");
      ga("require", "linkid", "linkid.js");
      ga("send", "pageview");
    </script>

    <script type="text/javascript">
      /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
      var disqus_shortname = "thereisnoplacelike1"; // required: replace example with your forum shortname

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function () {
        var dsq = document.createElement("script");
        dsq.type = "text/javascript";
        dsq.async = true;
        dsq.src = "//" + disqus_shortname + ".disqus.com/embed.js";
        (
          document.getElementsByTagName("head")[0] ||
          document.getElementsByTagName("body")[0]
        ).appendChild(dsq);
      })();

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function () {
        var s = document.createElement("script");
        s.async = true;
        s.type = "text/javascript";
        s.src = "//" + disqus_shortname + ".disqus.com/count.js";
        (
          document.getElementsByTagName("HEAD")[0] ||
          document.getElementsByTagName("BODY")[0]
        ).appendChild(s);
      })();
    </script>
    <noscript
      >Please enable JavaScript to view the
      <a href="http://disqus.com/?ref_noscript"
        >comments powered by Disqus.</a
      ></noscript
    >
    <a href="http://disqus.com" class="dsq-brlink"
      >comments powered by <span class="logo-disqus">Disqus</span></a
    >
  </body>
</html>
