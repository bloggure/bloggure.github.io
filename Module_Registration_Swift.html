<!DOCTYPE html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en">
  <!--<![endif]-->
  <head>
    <meta charset="utf-8" />
    <title>Swift module registration &#8211; Bloggure</title>
    <meta
      name="description"
      content="Multi author blog about programming, computing and geek stuff"
    />
    <meta name="keywords" content="ios, tuist, ioc" />

    <!-- Open Graph -->
    <meta property="og:locale" content="en_US" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Swift module registration" />
    <meta
      property="og:description"
      content="Multi author blog about programming, computing and geek stuff"
    />
    <meta
      property="og:url"
      content="http://www.bloggure.info/Module_Registration_Swift"
    />
    <meta property="og:site_name" content="Bloggure" />

    <link
      rel="canonical"
      href="http://www.bloggure.info/Module_Registration_Swift"
    />
    <link
      href="http://www.bloggure.info/feed.xml"
      type="application/atom+xml"
      rel="alternate"
      title="Bloggure Feed"
    />

    <!-- http://t.co/dKP3o1e -->
    <meta name="HandheldFriendly" content="True" />
    <meta name="MobileOptimized" content="320" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- For all browsers -->
    <link
      rel="stylesheet"
      href="http://www.bloggure.info/assets/css/main.css"
    />
    <!-- Webfonts -->
    <link
      href="https://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic"
      rel="stylesheet"
      type="text/css"
    />

    <meta http-equiv="cleartype" content="on" />

    <script>
      document.documentElement.className = document.documentElement.className.replace(
        /\bno-js\b/,
        "js"
      );
    </script>

    <!-- Icons -->
    <!-- 16x16 -->
    <link rel="shortcut icon" href="http://www.bloggure.info/favicon.ico" />
    <!-- 32x32 -->
    <link rel="shortcut icon" href="http://www.bloggure.info/favicon.png" />
    <!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
    <link
      rel="apple-touch-icon-precomposed"
      href="http://www.bloggure.info/images/apple-touch-icon-precomposed.png"
    />
    <!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
    <link
      rel="apple-touch-icon-precomposed"
      sizes="72x72"
      href="http://www.bloggure.info/images/apple-touch-icon-72x72-precomposed.png"
    />
    <!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
    <link
      rel="apple-touch-icon-precomposed"
      sizes="114x114"
      href="http://www.bloggure.info/images/apple-touch-icon-114x114-precomposed.png"
    />
    <!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
    <link
      rel="apple-touch-icon-precomposed"
      sizes="144x144"
      href="http://www.bloggure.info/images/apple-touch-icon-144x144-precomposed.png"
    />
  </head>

  <body id="post">
    <!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->

    <div class="entry-header">
      <header class="header-title">
        <div class="header-title-wrap">
          <h1 class="entry-title" itemprop="name">
            <a href="http://www.bloggure.info/">Bloggure</a>
          </h1>
        </div>
        <!-- /.header-title-wrap -->
      </header>
    </div>

    <div id="main" role="main">
      <article class="hentry">
        <div class="entry-content">
          <header>
            <div class="entry-meta">
              <span class="entry-date date published updated"
                ><time
                  datetime="2025-04-28T00:00:00+02:00"
                  itemprop="datePublished"
                  ><a href="http://www.bloggure.info/Module_Registration_Swift"
                    >April 28, 2025</a
                  ></time
                ></span
              ><span
                class="author vcard"
                itemprop="author"
                itemscope
                itemtype="http://schema.org/Person"
                ><span itemprop="name" class="fn"
                  ><a
                    href="http://www.bloggure.info/cgatay"
                    title="About cgatay"
                    itemprop="url"
                    >cgatay</a
                  ></span
                ></span
              >&nbsp; &bull; &nbsp;<span class="entry-comments"
                ><a
                  href="http://www.bloggure.info/Module_Registration_Swift#disqus_thread"
                  >Comment</a
                ></span
              >
            </div>
            <!-- /.entry-meta -->

            <h1 class="entry-title" itemprop="name">
              <a
                href="http://www.bloggure.info/Module_Registration_Swift"
                rel="bookmark"
                title="Swift module registration"
                itemprop="url"
                >Swift module registration</a
              >
            </h1>
          </header>
          <p>Swift module registration</p>

          <p>Let’s modularize our Swift code!</p>

          <p>
            I am using tuist for a while now in my projects. This tool was
            initially bring into the project’s scope to ease day to day
            developer operations : no more fiddling with conflicts in
            xcodeproject files !
          </p>

          <h3 id="tuist-">Tuist ?</h3>

          <p>What is tuist by the way ?</p>

          <p>
            Have you ever booted an iOS project, from a few years things have
            evolved a bit.
          </p>

          <p>
            Before 2020 I’d say we were doomed to using xcworkspace for defining
            complex projects.
          </p>

          <p>
            Cocoapod and Carthage were the cool kids on the block, allowing to
            download libraries and use them in our beautiful apps.
          </p>

          <p>
            After 2020, and still now, Swift development have changed to
            massively using SPM: the built in dependency management tool baked
            in the swift toolchain. The process is straightforward and easy to
            set up, a few clicks in XCode and voila! The other way of using SPM
            is by using a Package.swift file to describe what you want to
            achieve.
          </p>

          <p>
            The swift file works very well but lacks from a lot of advanced
            features available in XCode projects. Or if it is possible, it is
            not convenient to do.
          </p>

          <p>
            This is where tuist fills the gap, like Gradle in the Java ecosystem
            did a few years ago. We can finally use Swift to describe our Swift
            projects. This means no more copasting things over and over and the
            dreaded xcodeproj is no more : you’ll only ever have to merge swift
            files !
          </p>

          <h2 id="code-modularity-appears-">Code modularity appears !</h2>

          <p>
            It also came in handy for bringing modularity into our codebase. We
            managed to split dependencies and make modules per feature or
            functional scope.
          </p>

          <p>
            This comes at a cost, having to register our different modules to
            our main app. When I’m talking about registering, I’m considering
            handling dependencies, routing and navigation. This can represent a
            lot of modules, a lot of useless lines in our codebase.
          </p>

          <p>
            To be clearer, our main app contains authentication logic as well as
            basic http interactions, our modules are dumb as they depend on this
            external provider to be able to issue any http call.
          </p>

          <h2 id="first-implementation">First implementation</h2>

          <p>
            Every of our module was being added to our ResourceLoader class that
            would call the necessary initializers to set things in motion like
            the following
          </p>

          <figure class="highlight">
            <pre><code class="language-swift" data-lang="swift"><span class="kd">func</span> <span class="nf">register</span><span class="p">(){</span>
  <span class="kt">LoggingModule</span><span class="o">.</span><span class="nf">register</span><span class="p">()</span>
  <span class="err">…</span>
<span class="p">}</span></code></pre>
          </figure>

          <p>
            With our ResourceLoader implementing a protocol exposing everything
            that was useful for our submodules, protocol which was made
            available through a simple used-everywhere dependency.
          </p>

          <h2 id="auto-registration-for-the-win-">
            Auto-registration for the win !
          </h2>

          <p>
            We can do module autoregistration by scanning embedded frameworks.
            As we can do with IoC, the idea is to let every module declare
            itself to the main consumer. No more long
            <code>register</code> method in our application launch, and new
            modules are automatically discovered at launch time !
          </p>

          <p>
            Let’s illustrate this with some code, we declare a protocol that
            will allow consumer to call registration for our module.
          </p>

          <figure class="highlight">
            <pre><code class="language-swift" data-lang="swift"><span class="kd">public</span> <span class="kd">protocol</span> <span class="kt">ModuleRegistration</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">register</span><span class="p">()</span>
<span class="p">}</span></code></pre>
          </figure>

          <p>
            This is our base building block for registration, every module
            implements <code>ModuleRegistration</code> to contribute to the main
            app.
          </p>

          <p>
            In every module project, we then set a class that will be
            responsible for registration. It will implement this specific
            protocol and be populated by its full name into
            <code>Info.plist</code>.
          </p>

          <figure class="highlight">
            <pre><code class="language-swift" data-lang="swift"><span class="kd">@objc</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="kt">MyFrameworkRegistration</span><span class="p">:</span> <span class="kt">NSObject</span><span class="p">,</span> <span class="kt">ModuleRegistration</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kd">func</span> <span class="nf">register</span><span class="p">()</span> <span class="p">{</span>
      <span class="c1">// inject into the global context our dependencies</span>
      <span class="c1">// for instance we can do</span>
      <span class="c1">// Container.register(MyLogging.self, MyLoggingImpl.self)</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre>
          </figure>

          <p>
            Please notice important things in this class. It needs to be
            annotated <code>@objc</code> and inherit from
            <code>NSObject</code> to be discoverable later on.
          </p>

          <p>
            The magic being this is that we will declare this class to be our
            <code>NSPrincipalClass</code> in the <code>Info.plist</code> of our
            framework.
          </p>

          <p>
            To do so, we add the final touch by enriching the
            <code>Info.plist</code> of our module using Tuist project’s
            description :
          </p>

          <figure class="highlight">
            <pre><code class="language-swift" data-lang="swift"><span class="o">.</span><span class="nf">target</span><span class="p">(</span>
        <span class="nv">name</span><span class="p">:</span> <span class="s">"MyFramework"</span><span class="p">,</span>
        <span class="nv">destinations</span><span class="p">:</span> <span class="o">.</span><span class="n">iOS</span><span class="p">,</span>
        <span class="nv">product</span><span class="p">:</span> <span class="o">.</span><span class="n">framework</span><span class="p">,</span>
        <span class="nv">bundleId</span><span class="p">:</span> <span class="s">"org.9h41.ios.modules"</span><span class="p">,</span>
        <span class="nv">deploymentTargets</span><span class="p">:</span> <span class="o">.</span><span class="nf">iOS</span><span class="p">(</span><span class="s">"16.0"</span><span class="p">),</span>
        <span class="nv">infoPlist</span><span class="p">:</span> <span class="o">.</span><span class="nf">extendingDefault</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="p">[</span>
             <span class="s">"NSPrincipalClass"</span><span class="p">:</span> <span class="s">"MyFramework.MyFrameworkRegistration"</span><span class="p">,</span>
        <span class="p">]),</span>
        <span class="nv">sources</span><span class="p">:</span> <span class="o">.</span><span class="nf">paths</span><span class="p">([</span><span class="s">"MyFramework/Sources/**"</span><span class="p">])</span>
<span class="p">)</span></code></pre>
          </figure>

          <h2 id="main-app-implementation">Main app implementation</h2>

          <p>
            Then in our main app, we scan for <code>NSPrincipalClass</code> in
            all of our included bundles , one just need to call the
            <code>Modules.autoregister()</code> method in application startup.
          </p>

          <figure class="highlight">
            <pre><code class="language-swift" data-lang="swift"><span class="kd">public</span> <span class="kd">enum</span> <span class="kt">Modules</span> <span class="p">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">func</span> <span class="nf">autoregister</span><span class="p">()</span> <span class="p">{</span>
          <span class="kt">Bundle</span><span class="o">.</span><span class="n">allFrameworks</span><span class="o">.</span><span class="nf">compactMap</span><span class="p">(\</span><span class="o">.</span><span class="n">principalClass</span><span class="p">)</span>
              <span class="o">.</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">clazz</span> <span class="k">in</span>
                  <span class="nf">autoregister</span><span class="p">(</span><span class="nv">clazz</span><span class="p">:</span> <span class="n">clazz</span><span class="p">)</span>
              <span class="p">}</span>
  <span class="p">}</span>
  <span class="kd">static</span> <span class="kd">func</span> <span class="nf">autoregister</span><span class="p">(</span><span class="nv">clazz</span><span class="p">:</span> <span class="kt">AnyClass</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">instance</span> <span class="o">=</span> <span class="n">clazz</span><span class="o">.</span><span class="nf">alloc</span><span class="p">()</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">module</span> <span class="o">=</span> <span class="n">instance</span> <span class="k">as?</span> <span class="kt">ModuleRegistration</span> <span class="p">{</span>
            <span class="n">module</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="nf">debug</span><span class="p">(</span><span class="s">"Doing registration for </span><span class="se">\(</span><span class="n">clazz</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="n">module</span><span class="o">.</span><span class="nf">register</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre>
          </figure>

          <p>
            Our main app will then scan all included bundles, look for
            <code>NSPrincipalClass</code>, test if it matches the protocol
            requirement and then calls the registration function.
          </p>

          <p>
            The declared dependencies in our frameworks are now properly
            registered inside our app context, dependency injection system or
            anything you can imagine.
          </p>

          <footer class="entry-meta">
            <span class="entry-tags"
              ><a
                href="http://www.bloggure.info/tags/#ios"
                title="Pages tagged ios"
                class="tag"
                ><span class="term">ios</span></a
              ><a
                href="http://www.bloggure.info/tags/#tuist"
                title="Pages tagged tuist"
                class="tag"
                ><span class="term">tuist</span></a
              ><a
                href="http://www.bloggure.info/tags/#ioc"
                title="Pages tagged ioc"
                class="tag"
                ><span class="term">ioc</span></a
              ></span
            >

            <div class="social-share">
              <ul class="socialcount socialcount-small inline-list">
                <li class="facebook">
                  <a
                    href="https://www.facebook.com/sharer/sharer.php?u=http://www.bloggure.info/Module_Registration_Swift"
                    title="Share on Facebook"
                    ><span class="count"
                      ><i class="fa fa-facebook-square"></i> Like</span
                    ></a
                  >
                </li>
                <li class="twitter">
                  <a
                    href="https://twitter.com/intent/tweet?text=http://www.bloggure.info/Module_Registration_Swift"
                    title="Share on Twitter"
                    ><span class="count"
                      ><i class="fa fa-twitter-square"></i> Tweet</span
                    ></a
                  >
                </li>
              </ul>
            </div>
            <!-- /.social-share -->
          </footer>
        </div>
        <!-- /.entry-content -->
        <section id="disqus_thread"></section>
        <!-- /#disqus_thread -->
        <div class="read-more">
          <div class="read-more-header">
            <a
              href="http://www.bloggure.info/Swift_VisibleForTesting_Macro"
              class="read-more-btn"
              >Read More</a
            >
          </div>
          <!-- /.read-more-header -->
          <div class="read-more-content">
            <h3>
              <a
                href="http://www.bloggure.info/Shortcut_bill_renaming"
                title="Streamlining Finances: Automating Bill Renaming with Apple Shortcuts"
                >Streamlining Finances: Automating Bill Renaming with Apple
                Shortcuts</a
              >
            </h3>
            <p>
              ## The Problem: The "Downloads" Folder ChaosWe all know the
              struggle. You download a PDF invoice from your utility provider or
              internet s...&hellip;
              <a href="http://www.bloggure.info/Shortcut_bill_renaming"
                >Continue reading</a
              >
            </p>
          </div>
          <!-- /.read-more-content -->

          <div class="read-more-list">
            <div class="list-item">
              <h4>
                <a
                  href="http://www.bloggure.info/Tuist_build_test_schemes"
                  title="Tuist build test schemes"
                  >Tuist build test schemes</a
                >
              </h4>
              <span>Published on May 22, 2025</span>
            </div>
            <!-- /.list-item -->

            <div class="list-item">
              <h4>
                <a
                  href="http://www.bloggure.info/Swift_VisibleForTesting_Macro"
                  title="Swift macro : @VisibleForTesting"
                  >Swift macro : @VisibleForTesting</a
                >
              </h4>
              <span>Published on April 19, 2024</span>
            </div>
            <!-- /.list-item -->
          </div>
          <!-- /.read-more-list -->
        </div>
        <!-- /.read-more -->
      </article>
    </div>
    <!-- /#main -->

    <div class="footer-wrapper">
      <footer role="contentinfo">
        <span>
          See also
          <dl>
            <dt><a href="https://www.9h41.org">9h41</a></dt>
            <dt><a href="https://www.psy-tours.fr">Psy-Tours</a></dt>
          </dl>
        </span>
        <br />
        <span>
          &copy; 2026 . Powered by
          <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using a theme
          based on
          <a
            href="https://mademistakes.com/work/hpstr-jekyll-theme/"
            rel="nofollow"
            >HPSTR</a
          >.
        </span>
      </footer>
    </div>
    <!-- /.footer-wrapper -->

    <script>
      (function () {
        function loadScript(src) {
          return new Promise(function (resolve, reject) {
            var script = document.createElement("script");
            script.src = src;
            script.defer = true;
            script.async = false;
            script.onload = resolve;
            script.onerror = reject;
            document.head.appendChild(script);
          });
        }

        var jqCdn =
          "//ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js";
        var jqLocal =
          "http://www.bloggure.info/assets/js/vendor/jquery-3.7.1.min.js";
        var needFitVids = document.querySelector(
          "article iframe, article video"
        );
        var needMagnific = document.querySelector(
          'a[href$=".jpg" i],a[href$=".jpeg" i],a[href$=".png" i],a[href$=".gif" i]'
        );

        var jqPromise = loadScript(jqCdn)
          .catch(function () {
            return loadScript(jqLocal);
          })
          .then(function () {
            if (!window.jQuery) {
              return loadScript(jqLocal);
            }
          });

        jqPromise
          .then(function () {
            var chain = Promise.resolve();

            if (needFitVids) {
              chain = chain.then(function () {
                return loadScript(
                  "http://www.bloggure.info/assets/js/plugins/jquery.fitvids.js"
                );
              });
            }
            if (needMagnific) {
              chain = chain.then(function () {
                return loadScript(
                  "http://www.bloggure.info/assets/js/plugins/jquery.magnific-popup.js"
                );
              });
            }

            return chain;
          })
          .then(function () {
            return loadScript(
              "http://www.bloggure.info/assets/js/scripts.min.js"
            );
          });
      })();
    </script>

    <!-- Asynchronous Google Analytics snippet -->
    <script>
      (function (i, s, o, g, r, a, m) {
        i["GoogleAnalyticsObject"] = r;
        (i[r] =
          i[r] ||
          function () {
            (i[r].q = i[r].q || []).push(arguments);
          }),
          (i[r].l = 1 * new Date());
        (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m);
      })(
        window,
        document,
        "script",
        "//www.google-analytics.com/analytics.js",
        "ga"
      );

      ga("create", "UA-11718843-3", "auto");
      ga("require", "linkid", "linkid.js");
      ga("send", "pageview");
    </script>

    <script type="text/javascript">
      /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
      var disqus_shortname = "thereisnoplacelike1"; // required: replace example with your forum shortname

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function () {
        var dsq = document.createElement("script");
        dsq.type = "text/javascript";
        dsq.async = true;
        dsq.src = "//" + disqus_shortname + ".disqus.com/embed.js";
        (
          document.getElementsByTagName("head")[0] ||
          document.getElementsByTagName("body")[0]
        ).appendChild(dsq);
      })();

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function () {
        var s = document.createElement("script");
        s.async = true;
        s.type = "text/javascript";
        s.src = "//" + disqus_shortname + ".disqus.com/count.js";
        (
          document.getElementsByTagName("HEAD")[0] ||
          document.getElementsByTagName("BODY")[0]
        ).appendChild(s);
      })();
    </script>
    <noscript
      >Please enable JavaScript to view the
      <a href="http://disqus.com/?ref_noscript"
        >comments powered by Disqus.</a
      ></noscript
    >
    <a href="http://disqus.com" class="dsq-brlink"
      >comments powered by <span class="logo-disqus">Disqus</span></a
    >
  </body>
</html>
